<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navbar with Login Button - Database Ready (Responsive)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Base Styles --- */
        html, body {
            min-height: 100%;
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
            overflow-x: hidden; /* Prevent horizontal scrollbar */
        }
        /* Canvas for confetti - ensuring it's on top */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10000; /* Ensure confetti is above other elements */
        }

        /* --- Theme Colors (Classic Green & Gold, Darker Greenish Navbar) --- */
        :root {
            --theme-gold: #FDB813; /* Vibrant Gold from image */
            --theme-gold-darker: #EAA10F; /* Darker gold for hover */
            --theme-gold-darkest: #D48F0D; /* Even darker for active/pressed state */
            --theme-gold-light-bg: rgba(253, 184, 19, 0.2);
            --theme-gold-lighter-bg: rgba(253, 184, 19, 0.1); /* Used for search result hover */
            --theme-gold-highlight: rgba(253, 184, 19, 0.4);

            --theme-green-dark: #006A4E; /* Classic Green from image */
            --theme-green-darker-text: #00523D; /* Darker version for text */
            --theme-green-light-bg: rgba(0, 106, 78, 0.3);
            --theme-green-lighter-bg: rgba(0, 106, 78, 0.15);
            --theme-green-border: rgba(0, 106, 78, 0.7);
            /* Updated navbar background to a darker greenish color */
            --theme-navbar-bg: #C8E6C9; /* Darker Greenish Background */
            --neutral-border-color: #b0bec5; /* Slightly darker gray for contrast */
            --input-border-color: #b0bec5;
            --placeholder-text-color: #78909c; /* Darker placeholder */
            --off-white-text: #F5F5F5; /* Whitesmoke - for login button text */
        }

        /* --- Navbar Styling (Darker Greenish Background) --- */
        nav.sticky {
            background-color: var(--theme-navbar-bg) !important;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.08) !important; /* Adjusted shadow */
            border-bottom: 1px solid var(--theme-green-light-bg) !important;
        }

        /* Default Nav Link Color */
        .md\\:block .ml-10 a.nav-link-desktop,
        #mobile-menu a.nav-link-mobile,
        #mobile-menu button.nav-link-mobile {
            color: var(--theme-green-darker-text) !important; /* Dark green text still works */
            transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease, font-weight 0.2s ease;
            position: relative;
            overflow: visible !important;
            padding-bottom: 5px;
        }

        /* Nav links hover effect */
        .md\\:block .ml-10 a.nav-link-desktop:hover,
        #mobile-menu a.nav-link-mobile:hover,
        #mobile-menu button.nav-link-mobile:hover {
            background-color: var(--theme-gold-light-bg) !important;
            color: var(--theme-gold-darker) !important;
            transform: translateY(-2px);
            font-weight: 600 !important;
        }

        /* Nav link hover bar */
        .md\\:block .ml-10 a.nav-link-desktop::after,
        #mobile-menu a.nav-link-mobile::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 3px;
            background-color: var(--theme-gold);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease-out;
        }
        .md\\:block .ml-10 a.nav-link-desktop:hover::after,
        #mobile-menu a.nav-link-mobile:hover::after {
            transform: scaleX(1);
        }
         #mobile-menu button.nav-link-mobile::after { content: none !important; }
         #mobile-menu button.nav-link-mobile { padding-bottom: 0; }


        /* Logo hover effect */
        .flex-shrink-0 img.h-20 { transition: transform 0.3s ease, opacity 0.3s ease; }
        .flex-shrink-0 img.h-20:hover { transform: scale(1.08); opacity: 0.85; }

        /* Desktop Search Button */
        #search-open-button {
            background-color: rgba(255, 255, 255, 0.85); /* More opaque white */
            border: 1px solid var(--theme-green-border);
            border-radius: 0.375rem;
            padding: 0.4rem 0.75rem;
            max-width: 300px;
            display: flex;
            align-items: center;
            text-align: left;
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: var(--placeholder-text-color); /* Use updated placeholder color */
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        #search-open-button:hover {
            background-color: rgba(255, 255, 255, 0.95); /* Almost fully opaque on hover */
            border-color: var(--theme-green-dark);
        }
        #search-open-button:focus {
            outline: none;
            border-color: var(--theme-gold) !important;
            box-shadow: 0 0 0 2px var(--theme-gold-lighter-bg) !important;
        }
        #search-open-button .search-bar-icon {
            color: var(--theme-green-dark);
            margin-right: 0.5rem;
            flex-shrink: 0;
            height: 1.25rem;
            width: 1.25rem;
            transition: color 0.2s ease;
        }
        #search-open-button:hover .search-bar-icon {
            color: var(--theme-gold);
        }
        #search-open-button .search-bar-placeholder-text {
            color: var(--theme-green-darker-text); /* Dark green text remains legible */
            font-size: inherit;
            font-weight: normal;
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Keyboard Shortcut Hint Styling */
        .kbd-shortcut {
            display: inline-flex; align-items: center; justify-content: center;
            font-family: 'Inter', sans-serif; background-color: #e5e7eb;
            color: #4b5563; border: 1px solid #9ca3af;
            border-bottom-width: 2px; border-radius: 0.25rem;
            padding: 0.1rem 0.35rem; font-size: 0.7em;
            font-weight: 600; line-height: 1; white-space: nowrap;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        #search-open-button-mobile .kbd-shortcut {
            background-color: var(--theme-green-dark); color: var(--theme-gold);
            border-color: var(--theme-gold-darker);
        }
        #search-open-button-mobile:hover .kbd-shortcut {
            background-color: var(--theme-green-darker-text) !important; color: white !important;
            border-color: var(--theme-green-dark) !important;
        }
        #searchPlaceholderOverlay .kbd-shortcut {
            background-color: #f3f4f6; color: #6b7280; border-color: #d1d5db;
            font-size: 0.85em; font-weight: 500; padding: 0.05rem 0.25rem;
            margin: 0 0.1rem; border-bottom-width: 1px;
        }
        #searchPlaceholderOverlay .kbd-shortcut:hover {
            background-color: #f3f4f6; color: #6b7280; border-color: #d1d5db;
        }

        /* Keyframes for moving gradient */
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Enhanced Login Button Styling */
        #login-button, #mobile-login-button {
            background-image: linear-gradient(to right, var(--theme-gold) 0%, var(--theme-gold-darker) 50%, var(--theme-gold) 100%);
            background-size: 200% auto;
            color: var(--off-white-text);
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            line-height: 1.25rem;
            transition: background-position 0.4s ease-out, color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
            animation: moveGradient 4s linear infinite;
        }


        #login-button:hover, #mobile-login-button:hover {
            background-position: right center;
            color: var(--off-white-text);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 8px rgba(234, 161, 15, 0.3), 0 2px 4px rgba(234, 161, 15, 0.2);
        }

        #login-button:active, #mobile-login-button:active {
            transform: translateY(0px) scale(0.98);
            background-image: linear-gradient(to right, var(--theme-gold-darker) 0%, var(--theme-gold-darkest) 50%, var(--theme-gold-darker) 100%);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            color: var(--off-white-text);
        }

        #login-button:focus, #mobile-login-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px var(--theme-gold-light-bg), 0 4px 8px rgba(234, 161, 15, 0.3);
        }

        #mobile-login-button {
            width: 100%;
            margin-top: 0.75rem;
            padding: 0.75rem 1.2rem;
        }


        /* Mobile Menu Toggle Button Theming */
        .mobile-menu-button {
            color: var(--theme-green-darker-text) !important; /* Dark green text still works */
            background-color: transparent !important;
            transition: color 0.2s ease, background-color 0.2s ease;
        }
        .mobile-menu-button:hover {
            background-color: var(--theme-gold-light-bg) !important;
            color: var(--theme-gold-darker) !important;
        }
        .mobile-menu-button.focus\:ring-green-500:focus { --tw-ring-color: var(--theme-gold) !important; }


        /* Mobile menu general styling */
        #mobile-menu {
            background-color: var(--theme-navbar-bg); /* Ensure mobile menu also has the darker greenish bg */
        }
        #mobile-menu .border-t { /* Adjust border color in mobile menu */
             border-top-color: var(--theme-green-light-bg);
        }
        #mobile-menu a.hover\:bg-amber-100:hover {
            background-color: var(--theme-gold-light-bg) !important;
            color: var(--theme-green-darker-text) !important;
        }


        /* --- Search Overlay Styles with Animated Blob Background --- */
        #search-overlay {
            position: fixed; /* Ensures it covers the viewport */
            top: 0; left: 0; right: 0; bottom: 0;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            background-color: rgba(0, 40, 29, 0.65);
            z-index: 40; /* Higher than navbar */
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
            display: flex;
            padding: 2rem;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        #search-overlay.visible { opacity: 1; pointer-events: auto; }

        /* Animated Blobs */
        #search-overlay::before,
        #search-overlay::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            filter: blur(70px);
            opacity: 0;
        }

        #search-overlay::before { /* Gold Blob */
            width: 45vw; height: 45vw;
            min-width: 280px; max-width: 450px;
            min-height: 280px; max-height: 450px;
            background: var(--theme-gold);
            top: 5%; left: 5%;
            animation: moveBlob1 20s infinite alternate ease-in-out;
        }

        #search-overlay::after { /* Green Blob */
            width: 55vw; height: 55vw;
            min-width: 320px; max-width: 550px;
            min-height: 320px; max-height: 550px;
            background: var(--theme-green-dark);
            bottom: 2%; right: 2%;
            animation: moveBlob2 24s infinite alternate ease-in-out 2.5s;
        }

        @keyframes moveBlob1 {
            0%   { transform: translate(-15%, -15%) scale(0.8); opacity: 0.25; }
            25%  { transform: translate(15%, -5%) scale(1.1); opacity: 0.4; }
            50%  { transform: translate(5%, 15%) scale(0.9); opacity: 0.3; }
            75%  { transform: translate(-10%, 5%) scale(1.2); opacity: 0.45; }
            100% { transform: translate(-15%, -15%) scale(0.8); opacity: 0.25; }
        }

        @keyframes moveBlob2 {
            0%   { transform: translate(10%, 10%) scale(0.9); opacity: 0.3; }
            25%  { transform: translate(-5%, 15%) scale(0.7); opacity: 0.2; }
            50%  { transform: translate(-15%, -10%) scale(1.15); opacity: 0.4; }
            75%  { transform: translate(0%, -15%) scale(0.8); opacity: 0.25; }
            100% { transform: translate(10%, 10%) scale(0.9); opacity: 0.3; }
        }

        /* Content within the search overlay */
        .search-overlay-content {
            background-color: rgba(248, 249, 247, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            width: 100%; max-width: 48rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            border: 1px solid var(--neutral-border-color);
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out, background-color 0.3s ease, backdrop-filter 0.3s ease;
            position: relative;
            z-index: 1;
            max-height: calc(100vh - 4rem);
            display: flex; flex-direction: column;
        }
        #search-overlay.visible .search-overlay-content { transform: translateY(0); }

        .search-input-wrapper-overlay {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--neutral-border-color);
            flex-shrink: 0;
            position: relative; /* For positioning the clear button & spinner */
        }
        .search-icon-overlay { width: 1.5rem; height: 1.5rem; color: var(--theme-green-dark); margin-right: 0.75rem; flex-shrink: 0; }
        #searchInputOverlay {
            width: 100%;
            font-size: 1rem;
            line-height: 1.5rem;
            color: var(--theme-green-darker-text);
            background-color: transparent;
            border: none;
            outline: none;
            padding-right: 7.5rem; /* Increased padding for "Clear" text button AND spinner */
        }
        #searchInputOverlay::placeholder { color: #6c757d; opacity: 0.8; }

        /* Clear Search Input Button (Text Button) */
        #clearSearchInputButton {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background-color: transparent;
            color: var(--theme-green-dark);
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* medium */
            padding: 0.25rem 0.5rem; /* py-1 px-2 */
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid transparent; /* For consistent height with potential bordered buttons */
            display: none; /* JS toggles this with .visible */
            cursor: pointer;
            transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
            z-index: 20;
            white-space: nowrap; /* Prevent text wrapping */
        }
        #clearSearchInputButton:hover {
            color: var(--theme-gold-darker);
            background-color: var(--theme-gold-lighter-bg);
            border-color: var(--theme-gold);
        }
        #clearSearchInputButton.visible {
            display: inline-flex;
            align-items: center; /* Vertically align text if needed */
        }

        #loadingSpinnerOverlay {
            position: absolute;
            right: 4.5rem; /* Positioned to the left of the text "Clear" button */
            top: 50%;
            transform: translateY(-50%);
            display: none;
            z-index: 10;
        }
        #loadingSpinnerOverlay.visible { display: inline-block; }
        #loadingSpinnerOverlay svg { animation: spin 1s linear infinite; height: 1.25rem; width: 1.25rem; color: var(--theme-green-dark); }


        /* Main Close Button for the entire overlay (Top Right of Viewport) */
        .search-overlay-close-btn {
            position: absolute;
            top: 1.5rem; /* Distance from top of viewport */
            right: 1.5rem; /* Distance from right of viewport */
            padding: 0.5rem;
            border-radius: 9999px; /* Fully rounded */
            background-color: rgba(255, 255, 255, 0.1); /* Subtle background for visibility */
            color: #e5e7eb; /* Light color for visibility against dark overlay */
            transition: background-color 0.2s, color 0.2s;
            z-index: 50; /* Ensure it's above everything in the overlay */
            cursor: pointer;
        }
        .search-overlay-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.25);
            color: #ffffff;
        }
        .search-overlay-close-btn svg {
            width: 1.5rem; /* w-6 */
            height: 1.5rem; /* h-6 */
        }

        .sample-searches-overlay { padding: 0.75rem 1rem; border-bottom: 1px solid var(--neutral-border-color); display: flex; align-items: center; flex-wrap: wrap; gap: 0.5rem; flex-shrink: 0; background-color: rgba(248, 249, 247, 0.5); }
        .sample-searches-label-overlay { font-size: 0.875rem; color: var(--theme-green-dark); margin-right: 0.75rem; font-weight: 500; }
        .sample-search-item-overlay { font-size: 0.875rem; color: var(--theme-green-dark); background-color: var(--theme-green-lighter-bg); padding: 0.25rem 0.75rem; border-radius: 9999px; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease; border: 1px solid var(--theme-green-border); }
        .sample-search-item-overlay:hover { background-color: var(--theme-gold-light-bg); color: var(--theme-green-darker-text); border-color: var(--theme-gold); }

        .filters-container-overlay { padding: 0.75rem 1rem 1rem; background-color: rgba(248, 249, 247, 0.5); border-bottom: 1px solid var(--neutral-border-color); display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; flex-shrink: 0; }
        .filter-item-overlay { display: flex; flex-direction: column; }
        .filter-item-overlay label { font-size: 0.75rem; font-weight: 500; color: var(--theme-green-dark); margin-bottom: 0.25rem; }
        .filter-item-overlay select { width: 100%; padding: 0.5rem 0.75rem; font-size: 0.875rem; border: 1px solid var(--theme-green-border); border-radius: 0.375rem; background-color: rgba(255,255,255,0.8); transition: border-color 0.2s ease, box-shadow 0.2s ease; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23006A4E' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .filter-item-overlay select:focus { outline: none; border-color: var(--theme-gold); box-shadow: 0 0 0 2px var(--theme-gold-lighter-bg); }

        /* Search Results Area - Enhanced Layout */
        #search-results-overlay { padding: 0.5rem; overflow-y: auto; flex-grow: 1; }
        .search-result-item {
            display: block;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            text-decoration: none;
            margin-bottom: 0.5rem;
            border: 1px solid transparent;
        }
        .search-result-item:hover {
            background-color: var(--theme-gold-lighter-bg);
            border-color: var(--theme-gold);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .search-result-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--theme-green-dark);
            margin-bottom: 0.25rem;
            transition: color 0.2s ease-in-out;
        }
        .search-result-item:hover .search-result-title {
            color: var(--theme-green-darker-text);
        }

        .search-result-meta-primary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: #4b5563;
            margin-bottom: 0.375rem;
        }
        .search-result-item:hover .search-result-meta-primary {
            color: var(--theme-green-dark);
        }
        .search-result-author {
            font-weight: 500;
        }
        .search-result-year {
            color: #6b7280;
        }
        .search-result-item:hover .search-result-year {
            color: var(--theme-green-dark);
        }

        .search-result-category-keywords {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .search-result-category-tag {
            font-size: 0.7rem;
            font-weight: 500;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            background-color: var(--theme-green-lighter-bg);
            color: var(--theme-green-darker-text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .search-result-item:hover .search-result-category-tag {
            background-color: var(--theme-green-dark);
            color: white;
        }

        .search-result-keywords-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.375rem;
        }
        .keyword-pill {
            font-size: 0.7rem;
            background-color: #e5e7eb;
            color: #4b5563;
            padding: 0.125rem 0.625rem;
            border-radius: 9999px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .search-result-item:hover .keyword-pill {
            background-color: var(--theme-gold);
            color: var(--theme-green-darker-text);
        }

        .search-result-desc {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
            transition: color 0.2s ease-in-out;
        }
        .search-result-item:hover .search-result-desc {
            color: #374151;
        }

        .search-no-results { text-align: center; padding: 1rem; color: #6b7280; }
        .highlight { background-color: var(--theme-gold-light-bg) !important; color: var(--theme-green-darker-text) !important; font-weight: 600; padding: 0 2px; border-radius: 3px; }
        #search-results-overlay::-webkit-scrollbar { width: 6px; }
        #search-results-overlay::-webkit-scrollbar-track { background: var(--theme-green-lighter-bg); border-radius: 10px; }
        #search-results-overlay::-webkit-scrollbar-thumb { background: var(--theme-green-light-bg); border-radius: 10px; }
        #search-results-overlay::-webkit-scrollbar-thumb:hover { background: var(--theme-green-dark); }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        @media (min-width: 768px) { /* md breakpoint */
            #searchInputOverlay { font-size: 1.125rem; line-height: 1.75rem; }
        }

        /* Author search result styling */
        .author-result-item {
            background-color: var(--theme-green-lighter-bg);
            border-left: 3px solid var(--theme-green-dark);
        }
        .author-result-item:hover {
            background-color: var(--theme-green-light-bg);
            border-color: var(--theme-green-darker-text);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 106, 78, 0.15);
        }
        .author-result-item .search-result-title {
            color: var(--theme-green-darker-text);
            font-weight: 700;
        }
        .author-result-item .search-result-author-type {
            font-style: italic;
            color: var(--theme-green-dark);
        }
        .author-result-item .search-result-category-tag {
            background-color: var(--theme-green-dark);
            color: white;
        }
        
        /* Make document results more distinct */
        .search-result-item:not(.author-result-item) {
            border-left: 3px solid var(--theme-gold);
        }
        .search-result-item:not(.author-result-item):hover {
            border-color: var(--theme-gold-darker);
        }
    </style>
</head>
<body class="bg-gray-100">
    <canvas id="confetti-canvas"></canvas>
    <nav class="shadow-md sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <img class="h-20 w-auto" src="/Components/images/spud-logo.png" alt="MySite Logo" onerror="this.onerror=null; this.src='https://placehold.co/100x80/F9F6EE/006A4E?text=Logo';">
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="/index.html" class="nav-link-desktop text-gray-700 px-3 py-2 rounded-md text-sm font-medium">Home</a>
                            <a href="#" class="nav-link-desktop text-gray-700 px-3 py-2 rounded-md text-sm font-medium">About</a>
                            <a href="#" class="nav-link-desktop text-gray-700 px-3 py-2 rounded-md text-sm font-medium">Contact</a>
                        </div>
                    </div>
                </div>
                <div class="hidden md:flex md:items-center md:ml-6">
                    <div class="ml-4 flex items-center space-x-4">
                        <button id="search-open-button" type="button" class="focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white focus:ring-green-600 flex items-center">
                            <svg class="search-bar-icon h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
                            </svg>
                            <span class="search-bar-placeholder-text">Search (Ctrl+K)</span>
                        </button>
                        <button type="button" id="login-button" class="ml-3" onclick="handleLogin(event)">
                            Login
                        </button>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button type="button" class="mobile-menu-button bg-white inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="/index.html" class="nav-link-mobile text-gray-700 block px-3 py-2 rounded-md text-base font-medium">Home</a>
                <a href="/pages/doc-compiled.html" class="nav-link-mobile text-gray-700 block px-3 py-2 rounded-md text-base font-medium">Browse</a>
                <a href="#" class="nav-link-mobile text-gray-700 block px-3 py-2 rounded-md text-base font-medium">About</a>
                 <button id="search-open-button-mobile" type="button" class="nav-link-mobile w-full mt-2 text-left text-gray-700 block px-3 py-2 rounded-md text-base font-medium flex items-center justify-between">
                    Search
                    <span class="kbd-shortcut">Ctrl+K</span>
                </button>
            </div>
            <div class="pt-4 pb-3 border-t border-gray-200">
                <div class="px-2">
                    <button type="button" id="mobile-login-button" class="w-full" onclick="handleLogin(event)">
                        Login
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div id="search-overlay" class="hidden">
        <button id="search-close-button" type="button" class="search-overlay-close-btn">
            <span class="sr-only">Close search</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>
        </button>
        <div class="search-overlay-content">
            <div class="search-input-wrapper-overlay">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="search-icon-overlay">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
                <input type="text" id="searchInputOverlay" placeholder="Search articles, documents..." autocomplete="off" class=""/>
                <button id="clearSearchInputButton" type="button" aria-label="Clear search input">
                    Clear
                </button>
                 <div id="loadingSpinnerOverlay" aria-label="Loading search results">
                    <svg viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
            </div>
            <div class="sample-searches-overlay" id="sampleSearchesContainerOverlay">
                <span class="sample-searches-label-overlay">Trending</span>
                <span class="sample-search-item-overlay" data-query="JavaScript">JavaScript</span>
                <span class="sample-search-item-overlay" data-query="React">React</span>
                <span class="sample-search-item-overlay" data-query="API">API</span>
                <span class="sample-search-item-overlay" data-query="Design">Design</span>
                <span class="sample-search-item-overlay" data-query="Python">Python</span>
            </div>
            <div class="filters-container-overlay">
                <div class="filter-item-overlay">
                    <label for="categoryFilterOverlay">Category</label>
                    <select id="categoryFilterOverlay">
                        <option value="">All</option>
                        <option value="Thesis">Thesis</option>
                        <option value="Synergy">Synergy</option>
                        <option value="Confluence">Confluence</option>
                        <option value="Dissertation">Dissertation</option>
                    </select>
                </div>
                <div class="filter-item-overlay">
                    <label for="authorFilterOverlay">Author</label>
                    <select id="authorFilterOverlay">
                        <option value="">All</option>
                    </select>
                </div>
                <div class="filter-item-overlay">
                    <label for="keywordsFilterOverlay">Keyword(s)</label>
                    <select id="keywordsFilterOverlay">
                        <option value="">All</option>
                         </select>
                </div>
                <div class="filter-item-overlay">
                    <label for="yearFilterOverlay">Year</label>
                    <select id="yearFilterOverlay">
                        <option value="">All</option>
                    </select>
                </div>
            </div>
            <div id="search-results-overlay">
                 <p id="searchPlaceholderOverlay" class="search-no-results">Start typing, apply filters, or press <span class="kbd-shortcut">Ctrl+K</span> or <span class="kbd-shortcut">/</span> to search.</p>
            </div>
        </div>
    </div>

    

    <script>
        // Function to initialize navbar when directly loaded or included
        function initializePublicNavbar() {
            // API Endpoints - Updated to match the server endpoints
            const API = {
                // Documents and search endpoints
                documents: '/api/documents',
                document: (id) => `/api/documents/${id}`,
                compiledDocuments: '/api/compiled-documents',
                compiledDocument: (id) => `/api/compiled-documents/${id}`,
                
                // Filters and metadata endpoints
                authors: '/api/authors/all',
                documentAuthors: (id) => `/api/document-authors/${id}`,
                categories: '/api/category',
                
                // Research agenda endpoints
                researchAgenda: '/api/researchAgenda',
                topics: '/api/topics',
                
                // User-related endpoints
                userProfile: '/api/user/profile',
                userLibrary: '/api/user/library',
                userLibraryCount: '/api/user/library/count',
                
                // Archive endpoints
                archivedDocuments: '/api/archived-documents'
            };
            
            // Backwards-compatible single endpoints for ease of migration
            const SEARCH_API_ENDPOINT = API.documents;
            const TRENDING_TOPICS_API_ENDPOINT = API.researchAgenda;
            const CATEGORIES_API_ENDPOINT = API.categories;
            
            // Debug logging
            console.log('Initializing public navbar with API endpoints:');
            console.log('- Search API:', SEARCH_API_ENDPOINT);
            console.log('- Trending Topics API:', TRENDING_TOPICS_API_ENDPOINT);
            console.log('- Categories API:', CATEGORIES_API_ENDPOINT);
            console.log('- Full API object:', API);

            // UI Elements
            const searchOpenButton = document.getElementById('search-open-button');
            const searchOpenButtonMobile = document.getElementById('search-open-button-mobile');
            const searchCloseButton = document.getElementById('search-close-button');
            const searchOverlay = document.getElementById('search-overlay');
            const searchInputOverlay = document.getElementById('searchInputOverlay');
            const clearSearchInputButton = document.getElementById('clearSearchInputButton');
            const mobileMenuButton = document.querySelector('.mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuOpenIcon = mobileMenuButton?.querySelector('svg:not(.hidden)');
            const mobileMenuCloseIcon = mobileMenuButton?.querySelector('svg.hidden');
            const filtersButton = document.getElementById('filters-button');
            const filtersOverlay = document.getElementById('filters-overlay');
            const filtersCloseButton = document.getElementById('filters-close-button');
            const clearFiltersButton = document.getElementById('clear-filters-button');
            const searchResultsOverlay = document.getElementById('search-results-overlay');
            const loadingSpinnerOverlay = document.getElementById('loadingSpinnerOverlay');
            const sampleSearchesContainerOverlay = document.getElementById('sampleSearchesContainerOverlay');
            const categoryFilterOverlay = document.getElementById('categoryFilterOverlay');
            const authorFilterOverlay = document.getElementById('authorFilterOverlay');
            const keywordsFilterOverlay = document.getElementById('keywordsFilterOverlay');
            const yearFilterOverlay = document.getElementById('yearFilterOverlay');
            
            // Variables
            let debounceTimer;
            const DEBOUNCE_DELAY = 300;
            
            // Check if all required elements are present
            console.log('Checking for required UI elements:');
            console.log('- searchInputOverlay:', !!searchInputOverlay);
            console.log('- searchResultsOverlay:', !!searchResultsOverlay);
            console.log('- loadingSpinnerOverlay:', !!loadingSpinnerOverlay);
            console.log('- sampleSearchesContainerOverlay:', !!sampleSearchesContainerOverlay);
            
            // Initialize by fetching trending topics and categories
            fetchTrendingTopics();
            fetchCategories();
            fetchAuthors();
            initializeYearFilter();
            initializeKeywordsFilter();
            
            // Initialize year filter with reasonable year options
            function initializeYearFilter() {
                console.log('Initializing year filter dropdown');
                if (!yearFilterOverlay) {
                    console.error('Year filter element not found');
                    return;
                }
                
                try {
                    // Clear existing options except the "All" option
                    while (yearFilterOverlay.options.length > 1) {
                        yearFilterOverlay.remove(1);
                    }
                    
                    // Add year options from current year back to 2000
                    const currentYear = new Date().getFullYear();
                    for (let year = currentYear; year >= 2000; year--) {
                        const option = document.createElement('option');
                        option.value = year.toString();
                        option.textContent = year.toString();
                        yearFilterOverlay.appendChild(option);
                    }
                    
                    console.log(`Added year options from ${currentYear} to 2000`);
                    
                    // Add event listener for year filter changes
                    yearFilterOverlay.addEventListener('change', () => {
                        const query = searchInputOverlay.value.trim();
                        if (query.length > 0) {
                            performSearch(query);
                        }
                    });
                } catch (error) {
                    console.error('Error initializing year filter:', error);
                }
            }

            // Initialize keywords filter with common academic keywords
            function initializeKeywordsFilter() {
                console.log('Initializing keywords filter dropdown');
                if (!keywordsFilterOverlay) {
                    console.error('Keywords filter element not found');
                    return;
                }
                
                try {
                    // First try to fetch keywords from API
                    fetch('/api/keywords')
                        .then(response => {
                            if (response.ok) return response.json();
                            throw new Error('Failed to fetch keywords');
                        })
                        .then(data => {
                            populateKeywordsDropdown(data);
                        })
                        .catch(error => {
                            console.error('Error fetching keywords:', error);
                            // Use fallback keywords
                            const fallbackKeywords = [
                                "Research", "Academic", "Education", "Science", 
                                "Technology", "Engineering", "Mathematics", "Psychology",
                                "Sociology", "Business", "Economics", "Literature",
                                "Philosophy", "History", "Art", "Music", "Medicine",
                                "Computer Science", "Artificial Intelligence", "Data Analysis"
                            ];
                            populateKeywordsDropdown(fallbackKeywords);
                        });
                    
                    // Add event listener for keywords filter changes
                    keywordsFilterOverlay.addEventListener('change', () => {
                        const query = searchInputOverlay.value.trim();
                        if (query.length > 0) {
                            performSearch(query);
                        }
                    });
                } catch (error) {
                    console.error('Error initializing keywords filter:', error);
                }
                
                // Helper function to populate the keywords dropdown
                function populateKeywordsDropdown(keywords) {
                    // Clear existing options except the "All" option
                    while (keywordsFilterOverlay.options.length > 1) {
                        keywordsFilterOverlay.remove(1);
                    }
                    
                    // Process keywords data based on format
                    let keywordsList = [];
                    if (Array.isArray(keywords)) {
                        keywordsList = keywords;
                    } else if (keywords && keywords.keywords && Array.isArray(keywords.keywords)) {
                        keywordsList = keywords.keywords;
                    }
                    
                    // Add keywords to dropdown
                    keywordsList.forEach(keyword => {
                        const keywordText = typeof keyword === 'string' ? keyword : (keyword.name || keyword.keyword || '');
                        if (keywordText) {
                            const option = document.createElement('option');
                            option.value = keywordText;
                            option.textContent = keywordText;
                            keywordsFilterOverlay.appendChild(option);
                        }
                    });
                    
                    console.log(`Added ${keywordsList.length} keywords to filter dropdown`);
                }
            }

            // Mobile menu
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                const isCurrentlyExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
                    const openMenu = !isCurrentlyExpanded;
                mobileMenuButton.setAttribute('aria-expanded', openMenu.toString());
                mobileMenu.classList.toggle('hidden', !openMenu);
                    if (mobileMenuOpenIcon && mobileMenuCloseIcon) {
                mobileMenuOpenIcon.classList.toggle('hidden', openMenu);
                mobileMenuCloseIcon.classList.toggle('hidden', !openMenu);
                    }
                });
            }

            // Search functionality
            function openSearch() {
                if (!searchOverlay || !searchInputOverlay) return;
                document.body.style.overflow = 'hidden';
                searchOverlay.classList.remove('hidden');
                searchOverlay.classList.add('visible');
                setTimeout(() => {
                    searchInputOverlay.focus();
                    if (clearSearchInputButton) {
                        clearSearchInputButton.classList.toggle('visible', searchInputOverlay.value.length > 0);
                    }
                }, 50);
                
                if (mobileMenu && !mobileMenu.classList.contains('hidden') && mobileMenuButton) {
                    mobileMenuButton.setAttribute('aria-expanded', 'false');
                    mobileMenu.classList.add('hidden');
                    if (mobileMenuOpenIcon) mobileMenuOpenIcon.classList.remove('hidden');
                    if (mobileMenuCloseIcon) mobileMenuCloseIcon.classList.add('hidden');
                }
            }

            function closeSearch() {
                if (!searchOverlay) return;
                document.body.style.overflow = '';
                searchOverlay.classList.remove('visible');
                setTimeout(() => {
                searchOverlay.classList.add('hidden');
                }, 300);
            }
            
            if (searchOpenButton) {
                searchOpenButton.addEventListener('click', openSearch);
            }
            
            if (searchOpenButtonMobile) {
                searchOpenButtonMobile.addEventListener('click', openSearch);
            }
            
            if (searchCloseButton) {
                searchCloseButton.addEventListener('click', closeSearch);
            }
            
            if (searchOverlay) {
                searchOverlay.addEventListener('click', (event) => {
                    if (event.target === searchOverlay) {
                        closeSearch();
                    }
                });
            }
            
            // Clear search input
            if (clearSearchInputButton && searchInputOverlay) {
                clearSearchInputButton.addEventListener('click', () => {
                    searchInputOverlay.value = '';
                    searchInputOverlay.focus();
                    clearSearchInputButton.classList.remove('visible');
                    
                    // Reset search results
                    const placeholderText = `Start typing, apply filters, or press <span class="kbd-shortcut">Ctrl+K</span> or <span class="kbd-shortcut">/</span> to search.`;
                    searchResultsOverlay.innerHTML = `<p id="searchPlaceholderOverlay" class="search-no-results">${placeholderText}</p>`;
                });
                
                searchInputOverlay.addEventListener('input', () => {
                    clearSearchInputButton.classList.toggle('visible', searchInputOverlay.value.length > 0);
                    debounceSearch();
                });
            }
            
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    if (searchOverlay && searchOverlay.classList.contains('visible')) { closeSearch(); event.preventDefault(); return; }
                }
                const isInputFocused = document.activeElement?.tagName === 'INPUT' || document.activeElement?.tagName === 'TEXTAREA' || document.activeElement?.isContentEditable;
                if (event.key === '/' && !isInputFocused && searchOverlay && !searchOverlay.classList.contains('visible')) {
                    event.preventDefault(); openSearch();
                }
                if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 'k') {
                    event.preventDefault();
                    if (searchOverlay && searchOverlay.classList.contains('visible')) {
                        if (document.activeElement !== searchInputOverlay && searchInputOverlay) searchInputOverlay.focus();
                    } else { openSearch(); }
                }
            });
            
            // Search functionality
            function debounceSearch() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    const query = searchInputOverlay.value.trim();
                    
                    if (query.length >= 2) {
                        // Valid query length, proceed with search
                        performSearch(query);
                    } else if (query.length === 0) {
                        // Empty query, show default state
                        const placeholderText = `Start typing, apply filters, or press <span class="kbd-shortcut">Ctrl+K</span> or <span class="kbd-shortcut">/</span> to search.`;
                        searchResultsOverlay.innerHTML = `<p id="searchPlaceholderOverlay" class="search-no-results">${placeholderText}</p>`;
                    } else {
                        // Query too short, show feedback
                        searchResultsOverlay.innerHTML = `<p class="search-no-results">Please type at least 2 characters to search</p>`;
                        if (loadingSpinnerOverlay) {
                    loadingSpinnerOverlay.classList.remove('visible');
                        }
                    }
                }, DEBOUNCE_DELAY);
            }

            // Perform search with proper error handling
            async function performSearch(query) {
                console.log('Performing search with query:', query);
                
                if (loadingSpinnerOverlay) {
                loadingSpinnerOverlay.classList.add('visible');
                }
                
                try {
                    // Input validation
                    if (!query || query.length < 2) {
                        console.log('Search query too short:', query);
                        if (searchResultsOverlay) {
                            searchResultsOverlay.innerHTML = '<p class="search-no-results">Please enter at least 2 characters to search</p>';
                        }
                        return;
                    }
                    
                    const category = categoryFilterOverlay ? categoryFilterOverlay.value : '';
                    const author = authorFilterOverlay ? authorFilterOverlay.value : '';
                    const keywords = keywordsFilterOverlay ? keywordsFilterOverlay.value : '';
                    const year = yearFilterOverlay ? yearFilterOverlay.value : '';
                    
                    // Build the query parameters - matching documentController.ts exactly
                    const params = new URLSearchParams();
                    params.append('search', query); // Search parameter
                    if (category) params.append('category', category); // Category filter
                    if (author) params.append('author', author);
                    if (keywords) params.append('keywords', keywords);
                    if (year) params.append('year', year);
                    
                    // Pagination parameters - using 'size' as specified in documentController.ts
                    params.append('page', '1');
                    params.append('size', '10'); // Using 'size' parameter from documentController.ts
                    
                    // Sort parameter for newest documents first
                    params.append('sort', 'latest');
                    
                    // Create controller for timeout handling
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second timeout
                    
                    // Prepare for parallel requests
                    let documentResults = [];
                    let authorResults = [];
                    
                    try {
                        // 1. Fetch documents
                        const docUrl = new URL(API.documents, window.location.origin);
                        const docFullUrl = `${docUrl.toString()}?${params.toString()}`;
                        
                        console.log('%c Making document API request to:', 'background: #333; color: lime; padding: 3px;', docFullUrl);
                        
                        // 2. Prepare author search URL
                        const authorUrl = new URL('/api/authors/search', window.location.origin);
                        const authorParams = new URLSearchParams();
                        authorParams.append('q', query);
                        const authorFullUrl = `${authorUrl.toString()}?${authorParams.toString()}`;
                        
                        console.log('%c Making author API request to:', 'background: #333; color: #00FFFF; padding: 3px;', authorFullUrl);
                        
                        // 3. Make parallel requests
                        const [docResponse, authorResponse] = await Promise.allSettled([
                            fetch(docFullUrl, { signal: controller.signal }),
                            fetch(authorFullUrl, { signal: controller.signal })
                        ]);
                        
                        // 4. Process document results
                        if (docResponse.status === 'fulfilled' && docResponse.value.ok) {
                            const docData = await docResponse.value.json();
                            console.log('Document API response data:', docData);
                            
                            // Handle different response formats
                            if (docData && docData.documents) {
                                documentResults = docData.documents;
                            } else if (Array.isArray(docData)) {
                                documentResults = docData;
                            } else if (docData && typeof docData === 'object') {
                                const possibleArrayProps = Object.keys(docData).filter(key => 
                                    Array.isArray(docData[key]) && docData[key].length > 0 && 
                                    (docData[key][0].title || docData[key][0].name || docData[key][0].id)
                                );
                                
                                if (possibleArrayProps.length > 0) {
                                    documentResults = docData[possibleArrayProps[0]];
                                }
                            }
                        } else {
                            console.error('Document search failed:', docResponse);
                        }
                        
                        // 5. Process author results
                        if (authorResponse.status === 'fulfilled' && authorResponse.value.ok) {
                            const authorData = await authorResponse.value.json();
                            console.log('Author API response data:', authorData);
                            
                            if (Array.isArray(authorData)) {
                                authorResults = authorData;
                            } else if (authorData && authorData.authors && Array.isArray(authorData.authors)) {
                                authorResults = authorData.authors;
                            }
                            
                            // Transform author results to match document format for display
                            authorResults = authorResults.map(author => {
                                const fullName = author.full_name || 
                                                `${author.first_name || ''} ${author.middle_name || ''} ${author.last_name || ''}`.trim();
                                return {
                                    id: author.id,
                                    title: fullName,
                                    abstract: author.description || author.bio || `Author of academic works in the archives.`,
                                    category: 'Author Profile',
                                    document_type: 'Author',
                                    is_author: true,
                                    author_names: [fullName],
                                    keywords: author.specialization || author.research_interests || [],
                                    href: `/pages/authorprofile.html?id=${author.id}`
                                };
                            });
                        } else {
                            console.error('Author search failed:', authorResponse);
                        }
                    } finally {
                        clearTimeout(timeoutId);
                    }
                    
                    // Combine results, with authors displayed first
                    const combinedResults = [...authorResults, ...documentResults];
                    
                    if (combinedResults.length > 0) {
                        displaySearchResults(combinedResults, query);
                    } else {
                        console.warn('No search results found, using fallback');
                        displayMockSearchResults(query);
                    }
                } catch (error) {
                    console.error('Error performing search:', error);
                    if (error.name === 'AbortError') {
                        searchResultsOverlay.innerHTML = `<p class="search-no-results">Search request timed out. Please try again.</p>`;
                    } else {
                        searchResultsOverlay.innerHTML = `<p class="search-no-results">Error performing search: ${error.message}. Using fallback results.</p>`;
                        // Use mock data as fallback
                        displayMockSearchResults(query);
                    }
                } finally {
                    if (loadingSpinnerOverlay) {
                    loadingSpinnerOverlay.classList.remove('visible');
                    }
                }
            }
            
            // Fallback function to display mock search results when API fails
            function displayMockSearchResults(query) {
                console.log('Using mock search results for query:', query);
                
                // Mock data for testing/fallback - including both documents and authors
                const mockData = [
                    // Mock author results
                    {
                        id: 'a1',
                        title: "Dr. Maria Santos",
                        abstract: "Professor of Computer Science specializing in Artificial Intelligence and Machine Learning. Published several research papers on neural networks.",
                        category: "Author Profile",
                        document_type: "Author",
                        is_author: true,
                        keywords: ["Artificial Intelligence", "Machine Learning", "Neural Networks"],
                        href: "/pages/authorprofile.html?id=a1"
                    },
                    {
                        id: 'a2',
                        title: "Prof. James Wilson",
                        abstract: "Distinguished researcher in Environmental Science with publications focusing on climate change and sustainability.",
                        category: "Author Profile",
                        document_type: "Author",
                        is_author: true,
                        keywords: ["Environmental Science", "Climate Change", "Sustainability"],
                        href: "/pages/authorprofile.html?id=a2"
                    },
                    // Mock document results
                    {
                        id: '1',
                        title: "Understanding JavaScript Closures",
                        abstract: "A deep dive into closures in JavaScript, how they work, and common use cases. Essential for advanced JS development.",
                        category: "Thesis",
                        author_names: ["Dr. Ellie Script"],
                        keywords: ["JavaScript", "Closures", "Scope", "Functions"],
                        publication_date: "2023-05-15"
                    },
                    {
                        id: '2',
                        title: "Advanced React Patterns",
                        abstract: "Explore advanced patterns in React development, including HOCs, render props, and context API for scalable applications.",
                        category: "Dissertation",
                        author_names: ["Prof. Ada Component"],
                        keywords: ["React", "JavaScript", "Frontend", "Patterns", "Web"],
                        publication_date: "2024-01-10"
                    },
                    {
                        id: '3',
                        title: "Introduction to Python for Research",
                        abstract: "A beginner-friendly guide to using Python for data analysis in academic research projects, with Pandas and Matplotlib.",
                        category: "Thesis",
                        author_names: ["Dr. Guido Byte"],
                        keywords: ["Python", "Data Analysis", "Pandas", "Research"],
                        publication_date: "2023-09-22"
                    }
                ];
                
                // Filter mock data based on query
                const filteredData = mockData.filter(item => {
                    const titleMatch = item.title.toLowerCase().includes(query.toLowerCase());
                    const abstractMatch = item.abstract.toLowerCase().includes(query.toLowerCase());
                    const keywordMatch = item.keywords && Array.isArray(item.keywords) && 
                                        item.keywords.some(k => k.toLowerCase().includes(query.toLowerCase()));
                    
                    // For author results, match the title and abstract
                    if (item.is_author) {
                        return titleMatch || abstractMatch || keywordMatch;
                    }
                    
                    // For document results, also check author names
                    const authorMatch = item.author_names && Array.isArray(item.author_names) &&
                                      item.author_names.some(a => a.toLowerCase().includes(query.toLowerCase()));
                    
                    return titleMatch || abstractMatch || keywordMatch || authorMatch;
                });
                
                displaySearchResults(filteredData.length > 0 ? filteredData : mockData, query);
            }

            function displaySearchResults(results, query) {
                console.log('Displaying search results:', results);
                if (!searchResultsOverlay) {
                    console.error('Search results container not found');
                    return;
                }
                
                searchResultsOverlay.innerHTML = '';
                
                if (!Array.isArray(results) || results.length === 0) {
                    searchResultsOverlay.innerHTML = `<p class="search-no-results">No results found for "${highlightText(query, query)}"</p>`;
                    return;
                }
                
                const fragment = document.createDocumentFragment();
                
                results.forEach(item => {
                    // Skip results with no title
                    if (!item.title && !item.name) {
                        console.log('Skipping result with no title:', item);
                        return;
                    }
                    
                    const resultElement = document.createElement('a');
                    
                    // Determine the appropriate URL based on result type
                    let resultUrl;
                    if (item.is_author) {
                        // Author profile link
                        resultUrl = item.href || `/pages/authorprofile.html?id=${item.id}`;
                    } else {
                        // Document link - handle both regular and compiled documents
                        const isCompiled = item.is_compiled === true || item.doc_source === 'compiled';
                        resultUrl = isCompiled ? 
                            `/pages/doc-compiled-single.html?id=${item.id}` : 
                            `/pages/doc-single.html?id=${item.id}`;
                    }
                    
                    resultElement.href = resultUrl;
                    resultElement.target = "_self"; // Open in same tab
                    resultElement.classList.add('search-result-item');
                    
                    // Add appropriate result type class for different styling
                    if (item.is_author) {
                        resultElement.classList.add('author-result-item');
                    }
                    
                    const title = item.title || item.name || 'Untitled';
                    const abstract = item.abstract || item.description || '';
                    
                    const titleHighlighted = highlightText(title, query);
                    const descHighlighted = highlightText(abstract, query);
                    
                    let keywordsHTML = '';
                    if (item.keywords) {
                        const keywordsArray = Array.isArray(item.keywords) 
                            ? item.keywords 
                            : (typeof item.keywords === 'string' ? item.keywords.split(',').map(kw => kw.trim()) : []);
                        
                        keywordsHTML = keywordsArray
                            .filter(kw => kw) // Filter out empty strings
                            .map(kw => `<span class="keyword-pill">${kw}</span>`)
                            .join('');
                    }
                    
                    // Format publication date for documents
                    const publicationDate = !item.is_author && item.publication_date 
                        ? new Date(item.publication_date).getFullYear()
                        : (item.start_year || ''); // Use start_year for compiled documents
                    
                    // Get authors for documents (not needed for author results)
                    let authorName = '';
                    if (!item.is_author) {
                        if (Array.isArray(item.authors) && item.authors.length > 0) {
                            authorName = item.authors.map(author => {
                                if (typeof author === 'object') {
                                    return author.full_name || author.name || author.author_name || '';
                                }
                                return author; // Handle string entries
                            }).filter(Boolean).join(', ');
                        } else if (item.author_names && Array.isArray(item.author_names)) {
                            authorName = item.author_names.join(', ');
                        } else if (item.author) {
                            authorName = typeof item.author === 'string' ? item.author : '';
                        }
                    }
                    
                    // Build the result HTML based on type
                    if (item.is_author) {
                        // Author result
                        resultElement.innerHTML = `
                            <div class="search-result-title">${titleHighlighted || 'Unnamed Author'}</div>
                            <div class="search-result-meta-primary">
                                <span class="search-result-author-type">Author Profile</span>
                            </div>
                            <div class="search-result-category-keywords">
                                <span class="search-result-category-tag">Author</span>
                                ${keywordsHTML ? `<div class="search-result-keywords-container">${keywordsHTML}</div>` : ''}
                            </div>
                            <div class="search-result-desc">${descHighlighted || 'No author description available.'}</div>
                        `;
                    } else {
                        // Document result
                        resultElement.innerHTML = `
                            <div class="search-result-title">${titleHighlighted || 'Untitled Document'}</div>
                            <div class="search-result-meta-primary">
                                ${authorName ? `<span class="search-result-author">By: ${authorName}</span>` : ''}
                                ${publicationDate ? `<span class="search-result-year">${publicationDate}</span>` : ''}
                            </div>
                            <div class="search-result-category-keywords">
                                ${item.category || item.document_type ? `<span class="search-result-category-tag">${item.category || item.document_type}</span>` : ''}
                                ${keywordsHTML ? `<div class="search-result-keywords-container">${keywordsHTML}</div>` : ''}
                            </div>
                            <div class="search-result-desc">${descHighlighted || 'No abstract available.'}</div>
                        `;
                    }
                    
                    fragment.appendChild(resultElement);
                });
                
                searchResultsOverlay.appendChild(fragment);
            }

            function highlightText(text, query) {
                if (!query || typeof text !== 'string') return text || '';
                const escapedQuery = query.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                const regex = new RegExp(`(${escapedQuery})`, 'gi');
                return text.replace(regex, '<span class="highlight">$1</span>');
            }
            
            // Fetch trending topics from the research agenda API
            async function fetchTrendingTopics() {
                console.log('Fetching trending topics');
                if (!sampleSearchesContainerOverlay) {
                    console.error('Sample searches container not found');
                    return;
                }
                
                try {
                    const response = await fetch(`${API.researchAgenda}?limit=5`);
                    console.log('Trending topics API response status:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`Failed to fetch trending topics (status: ${response.status})`);
                    }
                    
                    const data = await response.json();
                    console.log('Trending topics API response data:', data);
                    
                    // Remove old event listener to prevent duplication
                    sampleSearchesContainerOverlay.removeEventListener('click', handleSampleSearchClick);
                    
                    // Clear existing trending topics except the label
                    const label = sampleSearchesContainerOverlay.querySelector('.sample-searches-label-overlay');
                    sampleSearchesContainerOverlay.innerHTML = '';
                    if (label) sampleSearchesContainerOverlay.appendChild(label);
                    
                    // Add new trending topics
                    if (Array.isArray(data) && data.length > 0) {
                        data.forEach(topic => {
                            const topicName = topic.name || topic;
                            const topicElement = document.createElement('span');
                            topicElement.classList.add('sample-search-item-overlay');
                            topicElement.dataset.query = topicName;
                            topicElement.textContent = topicName;
                            sampleSearchesContainerOverlay.appendChild(topicElement);
                        });
                    } else {
                        console.log('No trending topics found, using fallback topics');
                        // Add fallback trending topics if no data is returned
                        const fallbackTopics = ['Research', 'Thesis', 'Technology', 'Education', 'Psychology'];
                        fallbackTopics.forEach(topic => {
                            const topicElement = document.createElement('span');
                            topicElement.classList.add('sample-search-item-overlay');
                            topicElement.dataset.query = topic;
                            topicElement.textContent = topic;
                            sampleSearchesContainerOverlay.appendChild(topicElement);
                        });
                    }
                    
                    // Add event listener to the container (event delegation)
                    sampleSearchesContainerOverlay.addEventListener('click', handleSampleSearchClick);
                    
                } catch (error) {
                    console.error('Error fetching trending topics:', error);
                    // Add fallback trending topics in case of error
                    const fallbackTopics = ['Research', 'Thesis', 'Technology', 'Education', 'Psychology'];
                    fallbackTopics.forEach(topic => {
                        const topicElement = document.createElement('span');
                        topicElement.classList.add('sample-search-item-overlay');
                        topicElement.dataset.query = topic;
                        topicElement.textContent = topic;
                        sampleSearchesContainerOverlay.appendChild(topicElement);
                    });
                    
                    // Add event listener to the container (event delegation)
                    sampleSearchesContainerOverlay.addEventListener('click', handleSampleSearchClick);
                }
            }
            
            // Handler function for sample search clicks
            function handleSampleSearchClick(event) {
                    const target = event.target.closest('.sample-search-item-overlay');
                    if (target && target.dataset.query && searchInputOverlay) {
                        searchInputOverlay.value = target.dataset.query;
                    if (clearSearchInputButton) {
                        clearSearchInputButton.classList.add('visible');
                    }
                    performSearch(target.dataset.query);
                    searchInputOverlay.focus();
                }
            }
            
            // Fetch categories for the category filter
            async function fetchCategories() {
                console.log('Fetching categories');
                if (!categoryFilterOverlay) {
                    console.error('Category filter element not found');
                    return;
                }
                
                try {
                    const response = await fetch(API.categories);
                    console.log('Categories API response status:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`Failed to fetch categories (status: ${response.status})`);
                    }
                    
                    const data = await response.json();
                    console.log('Categories API response data:', data);
                    
                    // Clear existing options except the "All" option
                    while (categoryFilterOverlay.options.length > 1) {
                        categoryFilterOverlay.remove(1);
                    }
                    
                    // Add new categories
                    if (Array.isArray(data) && data.length > 0) {
                        data.forEach(category => {
                            const categoryName = category.name || category;
                            const option = document.createElement('option');
                            option.value = categoryName;
                            option.textContent = categoryName;
                            categoryFilterOverlay.appendChild(option);
                        });
                    }
                    
                    // Add event listener to the category filter
                    categoryFilterOverlay.addEventListener('change', () => {
                        const query = searchInputOverlay.value.trim();
                        if (query.length > 0) {
                            performSearch(query);
                        }
                    });
                } catch (error) {
                    console.error('Error fetching categories:', error);
                    // Add fallback categories in case of error
                    const fallbackCategories = ['Thesis', 'Dissertation', 'Journal', 'Research Paper'];
                    fallbackCategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categoryFilterOverlay.appendChild(option);
                    });
                }
            }
            
            // Fetch authors for the author filter
            async function fetchAuthors() {
                console.log('Fetching authors for filter');
                if (!authorFilterOverlay) {
                    console.error('Author filter element not found');
                    return;
                }
                
                try {
                    // Try to fetch authors from API
                    const response = await fetch(API.authors);
                    console.log('Authors API response status:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`Failed to fetch authors (status: ${response.status})`);
                    }
                    
                    const data = await response.json();
                    console.log('Authors API response data:', data);
                    
                    // Clear existing options except the "All" option
                    while (authorFilterOverlay.options.length > 1) {
                        authorFilterOverlay.remove(1);
                    }
                    
                    // Add new authors - handle different possible response formats
                    let authors = [];
                    if (data.authors && Array.isArray(data.authors)) {
                        authors = data.authors;
                    } else if (Array.isArray(data)) {
                        authors = data;
                    }
                    
                    if (authors.length > 0) {
                        authors.forEach(author => {
                            // Handle different author property formats
                            const authorName = author.full_name || author.name || 
                                            `${author.first_name || ''} ${author.last_name || ''}`.trim();
                            
                            if (authorName) {
                                const option = document.createElement('option');
                                option.value = authorName;
                                option.textContent = authorName;
                                authorFilterOverlay.appendChild(option);
                            }
                        });
                        console.log(`Added ${authors.length} authors to filter dropdown`);
                    } else {
                        console.warn('No authors found in response');
                    }
                    
                    // Add event listener to the author filter
                    authorFilterOverlay.addEventListener('change', () => {
                        const query = searchInputOverlay.value.trim();
                        if (query.length > 0) {
                            performSearch(query);
                        }
                    });
                } catch (error) {
                    console.error('Error fetching authors:', error);
                    // Add fallback authors
                    const fallbackAuthors = [
                        "Dr. Maria Santos",
                        "Prof. James Wilson",
                        "Dr. Ellie Script",
                        "Prof. Ada Component",
                        "Dr. Guido Byte"
                    ];
                    
                    fallbackAuthors.forEach(author => {
                        const option = document.createElement('option');
                        option.value = author;
                        option.textContent = author;
                        authorFilterOverlay.appendChild(option);
                    });
                    
                    console.log('Added fallback authors to filter dropdown');
                    
                    // Add event listener
                    authorFilterOverlay.addEventListener('change', () => {
                        const query = searchInputOverlay.value.trim();
                        if (query.length > 0) {
                            performSearch(query);
                        }
                    });
                }
            }
        }
        
        // Initialize when directly loaded
        document.addEventListener('DOMContentLoaded', initializePublicNavbar);
        
        // Also initialize when loaded via navbar-loader or if DOM is already loaded
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            console.log('DOM already loaded, initializing public navbar immediately');
            initializePublicNavbar();
        }
    </script>
</body>
</html>
