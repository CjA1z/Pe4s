<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Research Agenda</title>
    <!-- Clear any stale user data on page load -->
    <script>
    (function() {
        // This script runs immediately to clear any stale user data
        try {
            // Check for user info in sessionStorage
            const sessionUserInfo = sessionStorage.getItem('userInfo');
            if (sessionUserInfo) {
                try {
                    const userInfo = JSON.parse(sessionUserInfo);
                    
                    // If login time is more than 24 hours ago, clear it
                    if (userInfo.loginTime) {
                        const loginTime = new Date(userInfo.loginTime);
                        const currentTime = new Date();
                        const hoursSinceLogin = (currentTime - loginTime) / (1000 * 60 * 60);
                        
                        if (hoursSinceLogin > 24) {
                            console.log('Clearing stale session user data');
                            sessionStorage.removeItem('userInfo');
                        }
                    }
                } catch (e) {
                    console.error('Error parsing session user data, clearing it');
                    sessionStorage.removeItem('userInfo');
                }
            }
            
            // Check for user info in localStorage
            const localUserInfo = localStorage.getItem('userInfo');
            if (localUserInfo) {
                try {
                    const userInfo = JSON.parse(localUserInfo);
                    
                    // If login time is more than 24 hours ago, clear it
                    if (userInfo.loginTime) {
                        const loginTime = new Date(userInfo.loginTime);
                        const currentTime = new Date();
                        const hoursSinceLogin = (currentTime - loginTime) / (1000 * 60 * 60);
                        
                        if (hoursSinceLogin > 24) {
                            console.log('Clearing stale local user data');
                            localStorage.removeItem('userInfo');
                        }
                    }
                } catch (e) {
                    console.error('Error parsing local user data, clearing it');
                    localStorage.removeItem('userInfo');
                }
            }
        } catch (e) {
            console.error('Error cleaning up user data:', e);
        }
    })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Theme Colors (Combined & Prefixed) --- */
        :root {
            /* Footer Colors */
            --ft-theme-gold: #FDB813;
            --ft-theme-green-dark: #006A4E;
            --ft-neutral-border-color: #e5e7eb; 
            --ft-pastel-gold: #FFF5CC;
            --ft-pastel-green: #D0EAD0;
            --ft-glass-bg-color: rgba(255, 255, 255, 0.25); 
            --ft-glass-border-color: rgba(255, 255, 255, 0.4); 
            --ft-glass-blur-radius: 6px; 

            /* Navbar Colors (Using ft- prefix where applicable) */
            --nav-theme-gold: var(--ft-theme-gold); /* #FDB813; */
            --nav-theme-gold-darker: #EAA10F; 
            --nav-theme-gold-darkest: #D48F0D; 
            --nav-theme-gold-light-bg: rgba(253, 184, 19, 0.2);
            --nav-theme-gold-lighter-bg: rgba(253, 184, 19, 0.1); 
            --nav-theme-gold-highlight: rgba(253, 184, 19, 0.4);

            --nav-theme-green-dark: var(--ft-theme-green-dark); /* #006A4E; */
            --nav-theme-green-darker-text: #00523D; 
            --nav-theme-green-light-bg: rgba(0, 106, 78, 0.3);
            --nav-theme-green-lighter-bg: rgba(0, 106, 78, 0.15);
            --nav-theme-green-border: rgba(0, 106, 78, 0.7);
            --nav-theme-navbar-bg: #C8E6C9; /* Darker Greenish Background for Navbar */
            --nav-neutral-border-color: #b0bec5; 
            --nav-input-border-color: #b0bec5;
            --nav-placeholder-text-color: #78909c; 
            --nav-off-white-text: #F5F5F5; 
        }

        /* Basic HTML and Body setup for sticky footer */
        html {
            height: 100%;
            margin: 0;
            cursor: url('/components/images/peas-ico.png'), auto; /* Custom cursor for the whole page */
            scroll-behavior: smooth; /* Add smooth scrolling */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(to bottom right, #fdfae8, #e6f4ea);
            display: flex;
            flex-direction: column;
            min-height: 100%; 
            margin: 0;
            position: relative; 
            overflow-x: hidden; 
        }

        /* Wrapper for main page content (below navbar, above footer) */
        #page-content-container {
            flex-grow: 1; 
            padding-top: 4rem; /* Add padding to offset sticky navbar height (h-16 = 4rem) */
        }

        /* Canvas for confetti - ensuring it's on top */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10000; /* Ensure confetti is above other elements */
        }

        /* --- Navbar Styling --- */
        nav.sticky { /* Applied via class in HTML */
            background-color: var(--nav-theme-navbar-bg) !important;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.08) !important; 
            border-bottom: 1px solid var(--nav-theme-green-light-bg) !important;
        }
        /* Default Nav Link Color */
        .md\\:block .ml-10 a.nav-link-desktop,
        #mobile-menu a.nav-link-mobile,
        #mobile-menu button.nav-link-mobile {
            color: var(--nav-theme-green-darker-text) !important; 
            transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease, font-weight 0.2s ease;
            position: relative;
            overflow: visible !important;
            padding-bottom: 5px;
        }
        /* Nav links hover effect */
        .md\\:block .ml-10 a.nav-link-desktop:hover,
        #mobile-menu a.nav-link-mobile:hover,
        #mobile-menu button.nav-link-mobile:hover {
            background-color: var(--nav-theme-gold-light-bg) !important;
            color: var(--nav-theme-gold-darker) !important;
            transform: translateY(-2px);
            font-weight: 600 !important;
        }
        /* Nav link hover bar */
        .md\\:block .ml-10 a.nav-link-desktop::after,
        #mobile-menu a.nav-link-mobile::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 3px;
            background-color: var(--nav-theme-gold);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease-out;
        }
        .md\\:block .ml-10 a.nav-link-desktop:hover::after,
        #mobile-menu a.nav-link-mobile:hover::after {
            transform: scaleX(1);
        }
         #mobile-menu button.nav-link-mobile::after { content: none !important; }
         #mobile-menu button.nav-link-mobile { padding-bottom: 0; }
        /* Logo hover effect */
        .flex-shrink-0 img.navbar-logo { transition: transform 0.3s ease, opacity 0.3s ease; } /* Added specific class */
        .flex-shrink-0 img.navbar-logo:hover { transform: scale(1.08); opacity: 0.85; }
        /* Desktop Search Button */
        #search-open-button {
            background-color: rgba(255, 255, 255, 0.85); 
            border: 1px solid var(--nav-theme-green-border);
            border-radius: 0.375rem;
            padding: 0.4rem 0.75rem;
            max-width: 300px;
            display: flex;
            align-items: center;
            text-align: left;
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: var(--nav-placeholder-text-color); 
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            cursor: pointer;
        }
        #search-open-button:hover {
            background-color: rgba(255, 255, 255, 0.95); 
            border-color: var(--nav-theme-green-dark);
        }
        #search-open-button:focus {
            outline: none;
            border-color: var(--nav-theme-gold) !important;
            box-shadow: 0 0 0 2px var(--nav-theme-gold-lighter-bg) !important;
        }
        #search-open-button .search-bar-icon {
            color: var(--nav-theme-green-dark);
            margin-right: 0.5rem; flex-shrink: 0; height: 1.25rem; width: 1.25rem;
            transition: color 0.2s ease;
        }
        #search-open-button:hover .search-bar-icon { color: var(--nav-theme-gold); }
        #search-open-button .search-bar-placeholder-text {
            color: var(--nav-theme-green-darker-text); 
            font-size: inherit; font-weight: normal; flex-grow: 1;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        /* Keyboard Shortcut Hint Styling */
        .kbd-shortcut {
            display: inline-flex; align-items: center; justify-content: center;
            font-family: 'Inter', sans-serif; background-color: #e5e7eb;
            color: #4b5563; border: 1px solid #9ca3af;
            border-bottom-width: 2px; border-radius: 0.25rem;
            padding: 0.1rem 0.35rem; font-size: 0.7em;
            font-weight: 600; line-height: 1; white-space: nowrap;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        #search-open-button-mobile .kbd-shortcut {
            background-color: var(--nav-theme-green-dark); color: var(--nav-theme-gold);
            border-color: var(--nav-theme-gold-darker);
        }
        #search-open-button-mobile:hover .kbd-shortcut {
            background-color: var(--nav-theme-green-darker-text) !important; color: white !important;
            border-color: var(--nav-theme-green-dark) !important;
        }
        #searchPlaceholderOverlay .kbd-shortcut {
            background-color: #f3f4f6; color: #6b7280; border-color: #d1d5db;
            font-size: 0.85em; font-weight: 500; padding: 0.05rem 0.25rem;
            margin: 0 0.1rem; border-bottom-width: 1px;
        }
        #searchPlaceholderOverlay .kbd-shortcut:hover {
            background-color: #f3f4f6; color: #6b7280; border-color: #d1d5db;
        }
        /* Keyframes for moving gradient */
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        /* Enhanced Login Button Styling */
        #login-button, #mobile-login-button {
            background-image: linear-gradient(to right, var(--nav-theme-gold) 0%, var(--nav-theme-gold-darker) 50%, var(--nav-theme-gold) 100%);
            background-size: 200% auto;
            color: var(--nav-off-white-text);
            padding: 0.6rem 1.2rem; border-radius: 0.5rem;
            font-weight: 600; font-size: 0.875rem; line-height: 1.25rem;
            transition: background-position 0.4s ease-out, color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease;
            border: none; display: inline-flex; align-items: center; justify-content: center;
            cursor: pointer; text-decoration: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.08);
            position: relative; overflow: hidden;
            animation: moveGradient 4s linear infinite;
        }
        #login-button:hover, #mobile-login-button:hover {
            background-position: right center; color: var(--nav-off-white-text);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 8px rgba(234, 161, 15, 0.3), 0 2px 4px rgba(234, 161, 15, 0.2);
        }
        #login-button:active, #mobile-login-button:active {
            transform: translateY(0px) scale(0.98);
            background-image: linear-gradient(to right, var(--nav-theme-gold-darker) 0%, var(--nav-theme-gold-darkest) 50%, var(--nav-theme-gold-darker) 100%);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); color: var(--nav-off-white-text);
        }
        #login-button:focus, #mobile-login-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px var(--nav-theme-gold-light-bg), 0 4px 8px rgba(234, 161, 15, 0.3);
        }
        #mobile-login-button { width: 100%; margin-top: 0.75rem; padding: 0.75rem 1.2rem; }
        /* Mobile Menu Toggle Button Theming */
        .mobile-menu-button {
            color: var(--nav-theme-green-darker-text) !important; 
            background-color: transparent !important;
            transition: color 0.2s ease, background-color 0.2s ease;
        }
        .mobile-menu-button:hover {
            background-color: var(--nav-theme-gold-light-bg) !important;
            color: var(--nav-theme-gold-darker) !important;
        }
        .mobile-menu-button.focus\:ring-green-500:focus { --tw-ring-color: var(--nav-theme-gold) !important; }
        /* Mobile menu general styling */
        #mobile-menu { background-color: var(--nav-theme-navbar-bg); }
        #mobile-menu .border-t { border-top-color: var(--nav-theme-green-light-bg); }
        #mobile-menu a.hover\:bg-amber-100:hover {
            background-color: var(--nav-theme-gold-light-bg) !important;
            color: var(--nav-theme-green-darker-text) !important;
        }
        /* --- Search Overlay Styles with Animated Blob Background --- */
        #search-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            background-color: rgba(0, 40, 29, 0.65);
            z-index: 40; /* Higher than navbar (z-30) */
            opacity: 0; transition: opacity 0.3s ease-in-out;
            pointer-events: none; display: flex; padding: 2rem;
            justify-content: center; align-items: center; overflow: hidden;
        }
        #search-overlay.visible { opacity: 1; pointer-events: auto; }
        /* Animated Blobs */
        #search-overlay::before, #search-overlay::after {
            content: ''; position: absolute; border-radius: 50%;
            filter: blur(70px); opacity: 0;
        }
        #search-overlay::before { /* Gold Blob */
            width: 45vw; height: 45vw; min-width: 280px; max-width: 450px;
            min-height: 280px; max-height: 450px; background: var(--nav-theme-gold);
            top: 5%; left: 5%; animation: moveBlob1 20s infinite alternate ease-in-out;
        }
        #search-overlay::after { /* Green Blob */
            width: 55vw; height: 55vw; min-width: 320px; max-width: 550px;
            min-height: 320px; max-height: 550px; background: var(--nav-theme-green-dark);
            bottom: 2%; right: 2%; animation: moveBlob2 24s infinite alternate ease-in-out 2.5s;
        }
        @keyframes moveBlob1 {
            0%   { transform: translate(-15%, -15%) scale(0.8); opacity: 0.25; }
            25%  { transform: translate(15%, -5%) scale(1.1); opacity: 0.4; }
            50%  { transform: translate(5%, 15%) scale(0.9); opacity: 0.3; }
            75%  { transform: translate(-10%, 5%) scale(1.2); opacity: 0.45; }
            100% { transform: translate(-15%, -15%) scale(0.8); opacity: 0.25; }
        }
        @keyframes moveBlob2 {
            0%   { transform: translate(10%, 10%) scale(0.9); opacity: 0.3; }
            25%  { transform: translate(-5%, 15%) scale(0.7); opacity: 0.2; }
            50%  { transform: translate(-15%, -10%) scale(1.15); opacity: 0.4; }
            75%  { transform: translate(0%, -15%) scale(0.8); opacity: 0.25; }
            100% { transform: translate(10%, 10%) scale(0.9); opacity: 0.3; }
        }
        /* Content within the search overlay */
        .search-overlay-content {
            background-color: rgba(248, 249, 247, 0.85);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            width: 100%; max-width: 48rem; border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            border: 1px solid var(--nav-neutral-border-color);
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out, background-color 0.3s ease, backdrop-filter 0.3s ease;
            position: relative; z-index: 1; max-height: calc(100vh - 4rem);
            display: flex; flex-direction: column;
        }
        #search-overlay.visible .search-overlay-content { transform: translateY(0); }
        .search-input-wrapper-overlay {
            display: flex; align-items: center; padding: 1rem;
            border-bottom: 1px solid var(--nav-neutral-border-color);
            flex-shrink: 0; position: relative; 
        }
        .search-icon-overlay { width: 1.5rem; height: 1.5rem; color: var(--nav-theme-green-dark); margin-right: 0.75rem; flex-shrink: 0; }
        #searchInputOverlay {
            width: 100%; font-size: 1rem; line-height: 1.5rem;
            color: var(--nav-theme-green-darker-text); background-color: transparent;
            border: none; outline: none; padding-right: 7.5rem; 
        }
        #searchInputOverlay::placeholder { color: #6c757d; opacity: 0.8; }
        /* Clear Search Input Button (Text Button) */
        #clearSearchInputButton {
            position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%);
            background-color: transparent; color: var(--nav-theme-green-dark);
            font-size: 0.875rem; font-weight: 500; padding: 0.25rem 0.5rem; 
            border-radius: 0.375rem; border: 1px solid transparent; 
            display: none; cursor: pointer;
            transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
            z-index: 20; white-space: nowrap; 
        }
        #clearSearchInputButton:hover {
            color: var(--nav-theme-gold-darker); background-color: var(--nav-theme-gold-lighter-bg);
            border-color: var(--nav-theme-gold);
        }
        #clearSearchInputButton.visible { display: inline-flex; align-items: center; }
        #loadingSpinnerOverlay {
            position: absolute; right: 4.5rem; top: 50%; transform: translateY(-50%);
            display: none; z-index: 10;
        }
        #loadingSpinnerOverlay.visible { display: inline-block; }
        #loadingSpinnerOverlay svg { animation: spin 1s linear infinite; height: 1.25rem; width: 1.25rem; color: var(--nav-theme-green-dark); }
        /* Main Close Button for the entire overlay (Top Right of Viewport) */
        .search-overlay-close-btn {
            position: absolute; top: 1.5rem; right: 1.5rem; padding: 0.5rem;
            border-radius: 9999px; background-color: rgba(255, 255, 255, 0.1); 
            color: #e5e7eb; transition: background-color 0.2s, color 0.2s;
            z-index: 50; cursor: pointer;
        }
        .search-overlay-close-btn:hover { background-color: rgba(255, 255, 255, 0.25); color: #ffffff; }
        .search-overlay-close-btn svg { width: 1.5rem; height: 1.5rem; }
        .sample-searches-overlay { padding: 0.75rem 1rem; border-bottom: 1px solid var(--nav-neutral-border-color); display: flex; align-items: center; flex-wrap: wrap; gap: 0.5rem; flex-shrink: 0; background-color: rgba(248, 249, 247, 0.5); }
        .sample-searches-label-overlay { font-size: 0.875rem; color: var(--nav-theme-green-dark); margin-right: 0.75rem; font-weight: 500; }
        .sample-search-item-overlay { font-size: 0.875rem; color: var(--nav-theme-green-dark); background-color: var(--nav-theme-green-lighter-bg); padding: 0.25rem 0.75rem; border-radius: 9999px; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease; border: 1px solid var(--nav-theme-green-border); }
        .sample-search-item-overlay:hover { background-color: var(--nav-theme-gold-light-bg); color: var(--nav-theme-green-darker-text); border-color: var(--nav-theme-gold); }
        .filters-container-overlay { padding: 0.75rem 1rem 1rem; background-color: rgba(248, 249, 247, 0.5); border-bottom: 1px solid var(--nav-neutral-border-color); display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; flex-shrink: 0; }
        .filter-item-overlay { display: flex; flex-direction: column; }
        .filter-item-overlay label { font-size: 0.75rem; font-weight: 500; color: var(--nav-theme-green-dark); margin-bottom: 0.25rem; }
        .filter-item-overlay select { width: 100%; padding: 0.5rem 0.75rem; font-size: 0.875rem; border: 1px solid var(--nav-theme-green-border); border-radius: 0.375rem; background-color: rgba(255,255,255,0.8); transition: border-color 0.2s ease, box-shadow 0.2s ease; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23006A4E' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .filter-item-overlay select:focus { outline: none; border-color: var(--nav-theme-gold); box-shadow: 0 0 0 2px var(--nav-theme-gold-lighter-bg); }
        /* Search Results Area - Enhanced Layout */
        #search-results-overlay { padding: 0.5rem; overflow-y: auto; flex-grow: 1; }
        .search-result-item {
            display: block; padding: 0.75rem 1rem; border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            text-decoration: none; margin-bottom: 0.5rem; border: 1px solid transparent;
        }
        .search-result-item:hover {
            background-color: var(--nav-theme-gold-lighter-bg); border-color: var(--nav-theme-gold);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .search-result-title {
            font-weight: 600; font-size: 1rem; color: var(--nav-theme-green-dark);
            margin-bottom: 0.25rem; transition: color 0.2s ease-in-out;
        }
        .search-result-item:hover .search-result-title { color: var(--nav-theme-green-darker-text); }
        .search-result-meta-primary {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.75rem; color: #4b5563; margin-bottom: 0.375rem;
        }
        .search-result-item:hover .search-result-meta-primary { color: var(--nav-theme-green-dark); }
        .search-result-author { font-weight: 500; }
        .search-result-year { color: #6b7280; }
        .search-result-item:hover .search-result-year { color: var(--nav-theme-green-dark); }
        .search-result-category-keywords {
            margin-bottom: 0.5rem; display: flex; align-items: center;
            flex-wrap: wrap; gap: 0.5rem;
        }
        .search-result-category-tag {
            font-size: 0.7rem; font-weight: 500; padding: 0.125rem 0.5rem;
            border-radius: 9999px; background-color: var(--nav-theme-green-lighter-bg);
            color: var(--nav-theme-green-darker-text); text-transform: uppercase; letter-spacing: 0.05em;
        }
        .search-result-item:hover .search-result-category-tag {
            background-color: var(--nav-theme-green-dark); color: white;
        }
        .search-result-keywords-container { display: flex; flex-wrap: wrap; gap: 0.375rem; }
        .keyword-pill {
            font-size: 0.7rem; background-color: #e5e7eb; color: #4b5563;
            padding: 0.125rem 0.625rem; border-radius: 9999px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .search-result-item:hover .keyword-pill {
            background-color: var(--nav-theme-gold); color: var(--nav-theme-green-darker-text);
        }
        .search-result-desc {
            font-size: 0.875rem; color: #6b7280; line-height: 1.5;
            transition: color 0.2s ease-in-out;
        }
        .search-result-item:hover .search-result-desc { color: #374151; }
        .search-no-results { text-align: center; padding: 1rem; color: #6b7280; }
        .highlight { background-color: var(--nav-theme-gold-light-bg) !important; color: var(--nav-theme-green-darker-text) !important; font-weight: 600; padding: 0 2px; border-radius: 3px; }
        #search-results-overlay::-webkit-scrollbar { width: 6px; }
        #search-results-overlay::-webkit-scrollbar-track { background: var(--nav-theme-green-lighter-bg); border-radius: 10px; }
        #search-results-overlay::-webkit-scrollbar-thumb { background: var(--nav-theme-green-light-bg); border-radius: 10px; }
        #search-results-overlay::-webkit-scrollbar-thumb:hover { background: var(--nav-theme-green-dark); }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @media (min-width: 768px) { /* md breakpoint */
            #searchInputOverlay { font-size: 1.125rem; line-height: 1.75rem; }
        }

        /* --- Original Page Styles --- */
        .main-title { 
            user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
            margin-top: 2.5rem; 
        }
        .research-image-display { 
            display: block; width: 100%; max-width: 48rem; height: auto; 
            margin-left: auto; margin-right: auto; margin-bottom: 2.5rem; 
            border-radius: 0.75rem; 
            background: rgba(255, 255, 255, 0.2); 
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1); 
            user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer; 
            overflow: hidden; 
        }
        .research-image-display:hover {
            transform: scale(1.02); 
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.15); 
        }
        .agenda-container { 
            background-color: #ffffff; border-radius: 0.75rem; padding: 1.5rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
            max-width: 48rem; margin-left: auto; margin-right: auto;
        }
        .agenda-list li { 
            position: relative; padding: 0.5rem 0.5rem 0.5rem 1.75rem; margin-bottom: 0.75rem; 
            color: #374151; font-size: 0.95rem; font-weight: normal; line-height: 1.6;
            border-radius: 0.375rem; 
            transition: background-color 0.25s ease-in-out, transform 0.25s ease-in-out, font-weight 0.25s ease-in-out, box-shadow 0.25s ease-in-out;
            user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
            transform: scale(1); box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
        }
        .agenda-list li::before { 
            content: ''; position: absolute; left: 0.5rem; top: 50%;
            transform: translateY(-50%); height: 0.5rem; width: 0.5rem;  
            border-radius: 9999px; background-color: #22c55e; 
            transition: transform 0.25s ease-in-out;
        }
        .agenda-list li:hover {
            background-color: #e7f9ef; transform: scale(1.03); font-weight: bold; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
        }
        .agenda-list li:hover::before { transform: translateY(-50%) scale(1.2); }
        .image-modal {
            display: none; position: fixed; z-index: 10000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.85); 
            justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;
        }
        .image-modal.active { display: flex; }
        .modal-content { 
            display: block; margin: auto; max-width: 90%; max-height: 90vh; 
            border-radius: 8px; animation: zoomIn 0.3s ease-out; 
        }
        @keyframes zoomIn { 
            from {transform: scale(0.5); opacity: 0;}
            to {transform: scale(1); opacity: 1;}
        }
        .modal-close-button {
            position: absolute; top: 20px; right: 35px; color: #f1f1f1; 
            font-size: 40px; font-weight: bold; transition: 0.3s;
            cursor: pointer; user-select: none;
        }
        .modal-close-button:hover, .modal-close-button:focus { color: #bbb; text-decoration: none; }
        .d-animated-gradient-line { 
            height: 3px; width: 60%; margin: 2rem auto; 
            border-radius: 1.5px; background-color: #D1D5DB; 
        }
        @keyframes subtleBgMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .hero-section {
            background-size: 200% 200%; 
            animation: subtleBgMove 25s ease infinite; 
        }
        #heroCarousel { 
            background: rgba(255, 255, 255, 0.15); 
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            cursor: pointer; 
        }
        @keyframes movingGlowEffect { 
            0% { box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.7), inset 0 0 5px 2px rgba(255, 215, 0, 0.35); } 
            33% { box-shadow: 0 0 22px 9px rgba(60, 179, 113, 0.7), inset 0 0 7px 3px rgba(60, 179, 113, 0.35); }  
            66% { box-shadow: 0 0 18px 7px rgba(218, 165, 32, 0.7), inset 0 0 6px 2px rgba(218, 165, 32, 0.35); }  
            100% { box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.7), inset 0 0 5px 2px rgba(255, 215, 0, 0.35); } 
        }
        .carousel-item { 
            transition-property: opacity, transform; transition-duration: 700ms; 
            transition-timing-function: ease-in-out; position: relative; 
            animation: movingGlowEffect 5s ease-in-out infinite alternate; 
            overflow: hidden; 
        }
        .carousel-item::after {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(45deg, 
                rgba(253, 184, 19, 0.2), rgba(0, 106, 78, 0.2),   
                rgba(255, 245, 204, 0.15), rgba(208, 234, 208, 0.15),
                rgba(253, 184, 19, 0.2)  
            );
            background-size: 400% 400%; 
            animation: movingGradientOverlay 10s ease-in-out infinite; 
            z-index: 1; pointer-events: none; 
        }
        @keyframes movingGradientOverlay {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .carousel-item img { position: relative; z-index: 0; }
        .scroll-reveal-section {
            opacity: 0; transform: translateY(30px); 
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            will-change: opacity, transform; 
        }
        .scroll-reveal-section.is-visible { opacity: 1; transform: translateY(0); }
        
        /* --- Footer Styles --- */
        @keyframes subtleGradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .footer-wrapper { margin-top: auto; width: 100%; }
        .site-footer {
            position: relative; overflow: hidden;   
            background-color: var(--ft-glass-bg-color);
            -webkit-backdrop-filter: blur(var(--ft-glass-blur-radius)); 
            backdrop-filter: blur(var(--ft-glass-blur-radius));
            border: 1px solid var(--ft-glass-border-color);
            border-radius: 0; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            color: #374151; 
        }
        .site-footer::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1; 
            background: linear-gradient(45deg, var(--ft-pastel-gold), var(--ft-pastel-green), var(--ft-pastel-gold));
            background-size: 200% 200%; 
            animation: subtleGradientAnimation 18s ease infinite;
        }
        .footer-content-padding {
            position: relative; z-index: 1; 
            padding-top: 2rem; padding-bottom: 2rem; 
            padding-left: 1.5rem; padding-right: 1.5rem;  
            max-width: 80rem; margin-left: auto; margin-right: auto;     
        }
        @media (min-width: 640px) { 
            .footer-content-padding { padding-left: 2rem; padding-right: 2rem; }
        }
        @media (min-width: 1024px) { 
            .footer-content-padding { padding-left: 2.5rem; padding-right: 2.5rem; }
        }
        .footer-link {
            color: var(--ft-theme-green-dark);
            transition: color 0.2s ease-in-out, opacity 0.2s ease-in-out;
            text-decoration: none; font-weight: 500; 
        }
        .footer-link:hover { color: var(--ft-theme-gold); opacity: 1; }
        .copyright-text { color: #6b7280; }
    </style>
</head>
<body> 
    <canvas id="confetti-canvas"></canvas>
    <div id="navbarContainer">
        <!-- The navbar will be dynamically loaded here by navbar-loader.js -->
    </div>

    <div id="page-content-container" class="px-4 py-6 sm:px-6 lg:px-8"> <div class="hero-section relative overflow-hidden bg-gradient-to-br from-yellow-50 via-lime-50 to-green-100 rounded-xl shadow-lg py-12 md:py-16 mb-12 md:mb-16">
            <div class="absolute inset-0 z-0 flex justify-center items-center pointer-events-none p-4 md:p-8">
                <img src="/components/images/peas.png" alt="Background Logo Watermark" class="opacity-[0.035] w-auto h-full max-h-[60vh] md:max-h-[70vh] object-contain">
            </div>
            <div class="container mx-auto relative z-10 px-4 sm:px-6 lg:px-8">
                <div class="grid lg:grid-cols-2 gap-10 md:gap-16 items-center">
                    <div class="hero-carousel-column">
                        <div id="heroCarousel" class="relative w-full max-w-xl mx-auto shadow-2xl rounded-lg overflow-hidden border border-white/20 aspect-[4/3]">
                            <div class="carousel-inner relative w-full h-full">
                                <div class="carousel-item absolute inset-0 opacity-0 scale-95 p-1 rounded-[2rem] overflow-hidden">
                                    <img src="/components/images/1.jpg" class="block w-full h-full object-cover" alt="Research Initiative Photo 1" onerror="this.onerror=null;this.src='https://placehold.co/800x600/e2e8f0/94a3b8?text=Image+1+Not+Found';">
                                </div>
                                <div class="carousel-item absolute inset-0 opacity-0 scale-95 p-1 rounded-[2rem] overflow-hidden">
                                    <img src="/components/images/2.jpg" class="block w-full h-full object-cover" alt="Research Initiative Photo 2" onerror="this.onerror=null;this.src='https://placehold.co/800x600/e2e8f0/94a3b8?text=Image+2+Not+Found';">
                                </div>
                                <div class="carousel-item absolute inset-0 opacity-0 scale-95 p-1 rounded-[2rem] overflow-hidden">
                                    <img src="/components/images/3.jpg" class="block w-full h-full object-cover" alt="Research Initiative Photo 3" onerror="this.onerror=null;this.src='https://placehold.co/800x600/e2e8f0/94a3b8?text=Image+3+Not+Found';">
                                </div>
                                <div class="carousel-item absolute inset-0 opacity-0 scale-95 p-1 rounded-[2rem] overflow-hidden">
                                    <img src="/components/images/4.jpg" class="block w-full h-full object-cover" alt="Research Initiative Photo 4" onerror="this.onerror=null;this.src='https://placehold.co/800x600/e2e8f0/94a3b8?text=Image+4+Not+Found';">
                                </div>
                            </div>
                            <div class="carousel-indicators absolute bottom-2 sm:bottom-3 left-1/2 transform -translate-x-1/2 z-20 flex space-x-1.5 sm:space-x-2">
                                <button type="button" data-slide-to="0" class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-white/40 hover:bg-white/70 rounded-full transition-colors"></button>
                                <button type="button" data-slide-to="1" class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-white/40 hover:bg-white/70 rounded-full transition-colors"></button>
                                <button type="button" data-slide-to="2" class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-white/40 hover:bg-white/70 rounded-full transition-colors"></button>
                                <button type="button" data-slide-to="3" class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-white/40 hover:bg-white/70 rounded-full transition-colors"></button>
                            </div>
                        </div>
                    </div>
                    <div class="hero-text-column text-center lg:text-left"> 
                        <img src="/components/images/peas.png" 
                             alt="PeAS Logo" 
                             class="h-20 w-auto mb-4 mx-auto lg:mx-0" 
                             onerror="this.onerror=null;this.src='https://placehold.co/150x80/006A4E/FFFFFF?text=PeAS+Logo';">
                        
                        <h1 class="text-3xl lg:text-4xl font-bold text-green-800 mb-5 sm:mb-6">Welcome to the Office of Research &amp; Publications</h1>
                        <div class="space-y-4 text-base md:text-lg leading-relaxed text-gray-700">
                            <p>The Office of Research &amp; Publications of St. Paul University Dumaguete is proud to share the institution's research activities, initiatives and publications in this website.</p>
                            <p>Our innovations and scientific discoveries are expanding human knowledge and extending help to improve the institution and the public community.</p>
                            <p>The office provides standards aligned with its newly crafted research agenda and in parallel with the priorities mandated by several agencies towards sustainability and development goals of our country.</p>
                            <p>This is an avenue that would allow both faculty and students to engage in meaningful research and innovations to improve our understanding of the population we serve. The office strives for excellence, integrity, and ethics in our work, and dedicates all outputs to the pursuit of truth, knowledge, freedom, and holistic formation.</p>
                            
                            <div class="mt-6">
                                <a href="#about" class="inline-flex items-center px-5 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-700 hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all">
                                    View Research Agenda
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-animated-gradient-line" title="Divider"></div>

        <div class="container mx-auto"> 
            <div class="scroll-reveal-section" id="org-chart">
                <h2 class="main-title text-4xl font-bold text-center mb-10 md:mb-16 text-green-700">Organizational Chart</h2>
                <img src="/components/images/org-chart.png"
                     alt="Organization Chart (Click to enlarge)"
                     id="orgChartImage"
                     class="research-image-display"
                     onerror="this.onerror=null;this.src='https://placehold.co/768x500/e0e0e0/757575?text=Org+Chart+Not+Found';"> 
            </div>
            
            <div class="d-animated-gradient-line" title="Divider"></div>

            <div class="scroll-reveal-section" id="about">
                <h1 class="main-title text-4xl font-bold text-center mb-10 md:mb-16 text-green-700">Research Agenda</h1>
                <img src="/components/images/prism.png"
                     alt="Research Prism Diagram (Click to enlarge)"
                     id="prismImage"
                     class="research-image-display"
                     onerror="this.onerror=null;this.src='https://placehold.co/768x500/e0e0e0/757575?text=Prism+Diagram+Not+Found';">
                
                <div class="agenda-container">
                    <ul class="agenda-list" id="researchAgendaList">
                        <li>Paulinian Spirituality/Identity and its impact to international community and global partnerships</li>
                        <li>Paulinian Mission / Vision / Philosophy / Goals</li>
                        <li>Paulinian Roots and Formation</li>
                        <li>Advocacy (Peace, Pro-Life, Environment, Disaster & Risks Management)</li>
                        <li>Global Mental Health and Wellness</li>
                        <li>Synodal Church: Communion, Participation, and Mission</li>
                        <li>Inclusivity and Equity in Education</li>
                        <li>Curriculum development and Innovation geared towards internalization and global partnership</li>
                        <li>OBE - Instruction</li>
                        <li>Technology Integration</li>
                        <li>Faculty / Staff Development</li>
                        <li>Infrastructure / Software Development and Innovation</li>
                        <li>Financial Management, Sustainability, and Energy Security</li>
                        <li>Environmental Discipline and Stewardship</li>
                        <li>Ethical Leaders & Professionals</li>
                        <li>Cutting-edge Resilient Visionaries & Innovators; Engaging, Trustworthy Team Builders & Mentors; Reliable, Productive Experts & Implementers; Dedicated, Transformative Supporters & Stewardship in the context of international community and global partnerships</li>
                        <li>Civic and Community Involvement</li>
                        <li>Equality and Diversity</li>
                        <li>Economic cooperation and integration</li>
                        <li>Student and Faculty Mobility</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="imageModal" class="image-modal">
            <span class="modal-close-button" id="modalCloseButton">&times;</span>
            <img class="modal-content" id="modalImage" src="" alt="Maximized Image">
        </div>
    </div> 

    <div class="footer-wrapper"> 
        <footer class="site-footer">
            <div class="footer-content-padding"> 
                <div class="flex flex-col lg:flex-row lg:justify-between items-center lg:items-start gap-16 text-center lg:text-left">
                    <div class="flex-shrink-0">
                        <div class="flex flex-col items-center text-center sm:items-start sm:text-left mb-3">
                            <img class="h-16 w-auto sm:h-20 mb-2 sm:mb-0"
                                 src="/components/images/spud-logo.png" 
                                 alt="Spud Logo Placeholder"
                                 onerror="this.onerror=null; this.src='https://placehold.co/100x40/006A4E/FFFFFF?text=Spud';">
                        </div>
                        <p class="text-xs copyright-text">&copy; <span id="footerCurrentYear"></span> PeAS. All Rights Reserved.</p>
                    </div>
                    <nav class="flex flex-col items-center lg:items-start space-y-2 text-sm">
                        <a href="index.html" class="footer-link">Home</a>
                        <a href="contact.html" class="footer-link">Contact</a>
                        <a href="terms-conditions.html" class="footer-link">Terms & Conditions</a>
                        <a href="privacy-policy.html" class="footer-link">Privacy Policy</a>
                    </nav>
                </div>
            </div>
        </footer>
    </div>

    <!-- Back to top button -->
    <a href="#" id="back-to-top" class="fixed bottom-5 right-5 z-50 bg-green-700 text-white rounded-full shadow-lg p-3 flex items-center justify-center transition-all duration-300 opacity-0 invisible">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </a>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Original Page Logic ---
            // Scroll Reveal Logic
            const revealElements = document.querySelectorAll('.scroll-reveal-section');
            const revealObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target); 
                    }
                });
            }, { threshold: 0.1 });
            revealElements.forEach(el => { revealObserver.observe(el); });

            // Carousel Logic
            const carousel = document.getElementById('heroCarousel');
            if (carousel) {
                const items = carousel.querySelectorAll('.carousel-item');
                const indicators = carousel.querySelectorAll('.carousel-indicators button');
                let currentIndex = 0;
                const totalItems = items.length;
                let autoSlideInterval;
                function showSlide(index) {
                    currentIndex = (index + totalItems) % totalItems; 
                    items.forEach((item, i) => {
                        const isActive = i === currentIndex;
                        item.classList.toggle('opacity-100', isActive); 
                        item.classList.toggle('scale-100', isActive);   
                        item.classList.toggle('opacity-0', !isActive);  
                        item.classList.toggle('scale-95', !isActive);   
                        item.classList.toggle('z-10', isActive); 
                        item.classList.toggle('z-0', !isActive);  
                    });
                    indicators.forEach((indicator, i) => {
                        indicator.classList.toggle('bg-white', i === currentIndex); 
                        indicator.classList.toggle('bg-white/40', i !== currentIndex); 
                    });
                }
                function nextSlide() { showSlide(currentIndex + 1); }
                function prevSlide() { showSlide(currentIndex - 1); }
                function startAutoSlide() {
                    stopAutoSlide(); 
                    if (totalItems > 1) { autoSlideInterval = setInterval(nextSlide, 3000); }
                }
                function stopAutoSlide() { clearInterval(autoSlideInterval); }
                if (totalItems > 0) {
                    carousel.addEventListener('click', (e) => {
                        if (e.target.closest('.carousel-indicators button')) return; 
                        const rect = carousel.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        if (x < rect.width / 2) { prevSlide(); } else { nextSlide(); }
                        stopAutoSlide(); startAutoSlide(); 
                    });
                    carousel.addEventListener('mouseenter', stopAutoSlide);
                    carousel.addEventListener('mouseleave', startAutoSlide);
                    indicators.forEach((indicator, i) => {
                        indicator.addEventListener('click', (e) => { 
                            e.stopPropagation(); showSlide(i); stopAutoSlide(); startAutoSlide(); 
                        });
                    });
                    if (items[0]) { 
                        items[0].classList.remove('opacity-0', 'scale-95');
                        items[0].classList.add('opacity-100', 'scale-100', 'z-10');
                    }
                     if (indicators[0]) { 
                        indicators[0].classList.remove('bg-white/40');
                        indicators[0].classList.add('bg-white');
                    }
                    startAutoSlide(); 
                }
            }

            // Image Modal Logic
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalCloseButton = document.getElementById('modalCloseButton');
            const openModalWithImage = (imageUrl, imageAlt) => {
                if (modal && modalImage) {
                    modalImage.src = imageUrl;
                    modalImage.alt = imageAlt || "Maximized Image";
                    modal.classList.add('active'); 
                    document.body.style.overflow = 'hidden'; 
                }
            };
            const orgChartImage = document.getElementById('orgChartImage');
            const prismImage = document.getElementById('prismImage');
            if (orgChartImage) { orgChartImage.addEventListener('click', () => { openModalWithImage(orgChartImage.src, orgChartImage.alt); }); }
            if (prismImage) { prismImage.addEventListener('click', () => { openModalWithImage(prismImage.src, prismImage.alt); }); }
            if (modal && modalCloseButton) {
                const closeModal = () => { modal.classList.remove('active'); document.body.style.overflow = ''; };
                modalCloseButton.addEventListener('click', closeModal);
                modal.addEventListener('click', (event) => { if (event.target === modal) { closeModal(); } });
                document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && modal.classList.contains('active')) { closeModal(); } });
            }

            // Footer Year Logic
            const yearElement = document.getElementById('footerCurrentYear');
            if (yearElement) { yearElement.textContent = new Date().getFullYear(); }

            console.log("Page-specific scripts initialized.");
        });

        // Add smooth scrolling with offset for fixed header
        document.addEventListener('DOMContentLoaded', function() {
            // Get all links that jump to sections within the page
            const internalLinks = document.querySelectorAll('a[href^="#"]');
            
            // Add click event listeners to each internal link
            internalLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Only handle links to sections (not empty # links)
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    e.preventDefault();
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        // Get the height of the fixed navbar
                        const navbarHeight = document.querySelector('nav').offsetHeight;
                        
                        // Calculate the target position, accounting for the navbar
                        const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - navbarHeight;
                        
                        // Scroll to the target position with smooth behavior
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                        
                        // Update the URL to show the section ID (for shareable links)
                        history.pushState(null, '', targetId);
                    }
                });
            });
            
            // Handle initial page load with hash in URL
            if (window.location.hash) {
                setTimeout(function() {
                    const targetElement = document.querySelector(window.location.hash);
                    if (targetElement) {
                        const navbarHeight = document.querySelector('nav').offsetHeight;
                        const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - navbarHeight;
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                }, 500); // Delay to ensure page is fully loaded
            }
        });

        // Back to top button functionality
        document.addEventListener('DOMContentLoaded', function() {
            const backToTopButton = document.getElementById('back-to-top');
            
            if (backToTopButton) {
                // Show button when scrolling down past a certain point
                window.addEventListener('scroll', function() {
                    if (window.scrollY > 500) {
                        backToTopButton.classList.remove('opacity-0', 'invisible');
                        backToTopButton.classList.add('opacity-100');
                    } else {
                        backToTopButton.classList.remove('opacity-100');
                        backToTopButton.classList.add('opacity-0', 'invisible');
                    }
                });
                
                // Smooth scroll to top when clicked
                backToTopButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            }
        });
    </script>
    
    <!-- Navbar Manager: Dynamically loads the appropriate navbar based on user role -->
    <script src="/Components/js/navbar-loader.js"></script>
    
    <!-- Failsafe logout function that will be available globally -->
    <script>
        // Global failsafe logout function
        window.handleLogout = function(event) {
            if (event) event.preventDefault();
            console.log('FAILSAFE LOGOUT: Global index.html logout function called');
            
            // Clear all user data
            sessionStorage.removeItem('userInfo');
            localStorage.removeItem('userInfo');
            
            // Clear all cookies
            document.cookie.split(";").forEach(function(c) {
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
            });
            
            // Add timestamp for cache busting
            window.location.href = `/index.html?logout=true&t=${Date.now()}`;
        };
        
        // Also make regular logout function available
        window.logout = window.handleLogout;
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Debug logging
            console.log('DEBUG: Starting navbar initialization');
            console.log('DEBUG: localStorage userInfo =', localStorage.getItem('userInfo'));
            console.log('DEBUG: sessionStorage userInfo =', sessionStorage.getItem('userInfo'));
            console.log('DEBUG: Checking NavbarModule constants:');
            if (window.NavbarModule) {
                console.log('DEBUG: NavbarModule found');
                // Force clean state for testing
                // localStorage.removeItem('userInfo');
                // sessionStorage.removeItem('userInfo');
                // console.log('DEBUG: Storage cleared for testing');
            } else {
                console.error('DEBUG: NavbarModule not found - script might not be loading correctly');
            }
            
            // Initialize the navbar
            if (window.NavbarModule) {
                window.NavbarModule.init();

                // Add event listener to force navbar refresh when userInfo changes
                window.addEventListener('storage', function(event) {
                    if (event.key === 'userInfo') {
                        console.log('User info changed, refreshing navbar...');
                        window.NavbarModule.init();
                    }
                });
                
                // Force refresh on page load if coming from login
                if (document.referrer.includes('log-in.html')) {
                    console.log('Coming from login page, refreshing navbar...');
                    setTimeout(() => window.NavbarModule.init(), 100);
                }
            } else {
                console.error('NavbarModule not found! Make sure navbar-loader.js is loaded correctly.');
            }
            
            // Record page visit for the home page
            if (typeof recordPageVisit !== 'function') {
                // Define a placeholder if the function doesn't exist
                window.recordPageVisit = function() {
                    console.log('Page visit recording is not implemented yet');
                };
            }
            recordPageVisit();
        });
    </script>
   
</body>
</html>
