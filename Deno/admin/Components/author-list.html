<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Author List</title>
  <link rel="stylesheet" href="/admin/Components/css/side_bar.css">
  <link rel="stylesheet" href="/admin/Components/css/navbar_header.css">
  <link rel="stylesheet" href="/admin/Components/css/documents_page.css">
  <link rel="stylesheet" href="/admin/Components/css/author-list.css">
  
  <!-- React and ReactDOM for the compiled TypeScript component (using v17 which is more stable) -->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
  
  <!-- Debug script -->
  <script>
    console.log('Loading compiled TypeScript component');
    document.addEventListener('DOMContentLoaded', () => {
      console.log("React is loaded:", !!window.React);
      console.log("ReactDOM is loaded:", !!window.ReactDOM);
    });
  </script>
</head>
<body>
  <div id="header-container"></div>
  <div id="sidebar-container"></div>
  <!-- Mount point for the React component - positioned to match sidebar layout -->
  <div id="react-author-list" class="main-content">
    <!-- Fallback content if React doesn't load (will be replaced by React) -->
    <div class="react-loading">Loading Author List Component...</div>
  </div>
    
  <!-- Debug console for React mounting -->
  <script>
    console.log('Initial HTML loaded, found mount point:', document.getElementById('react-author-list'));
  </script>

  <!-- Load header and sidebar -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Load header and sidebar
      fetch('/admin/Components/navbar_header.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('header-container').innerHTML = data;
          // Execute any scripts in the header
          const scripts = document.getElementById('header-container').querySelectorAll('script');
          scripts.forEach(script => {
            const newScript = document.createElement('script');
            if (script.src) newScript.src = script.src;
            else newScript.textContent = script.textContent;
            document.head.appendChild(newScript);
          });
        })
        .catch(error => {
          console.error("Error loading navbar:", error);
          document.getElementById('header-container').innerHTML = '<div class="error">Error loading header</div>';
        });

      fetch('/admin/Components/side_bar.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('sidebar-container').innerHTML = data;
          // Execute any scripts in the sidebar
          const scripts = document.getElementById('sidebar-container').querySelectorAll('script');
          scripts.forEach(script => {
            const newScript = document.createElement('script');
            if (script.src) newScript.src = script.src;
            else newScript.textContent = script.textContent;
            document.head.appendChild(newScript);
          });
        })
        .catch(error => {
          console.error("Error loading sidebar:", error);
          document.getElementById('sidebar-container').innerHTML = '<div class="error">Error loading sidebar</div>';
        });
    });
  </script>
  
  <!-- Load the compiled TypeScript component (no Babel needed) from a path the server can serve -->
  <script>
    console.log('Loading compiled JS file from /admin/Components/js/author-list-compiled.js');
  </script>
  <script src="/admin/Components/js/author-list-compiled.js"></script>
  
  <!-- Mount the React component (auto-mounts) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM loaded, compiled component should auto-initialize');
      // The compiled component will auto-initialize
      // Mark as mounted to avoid fallback timeout
      const container = document.getElementById('react-author-list');
      if (container) {
        container.dataset.mounted = 'true';
      }
    });
  </script>
  
  <!-- Fallback script in case the main script fails -->
  <script>
    // Wait a bit to check if the component mounted
    setTimeout(() => {
      const mountPoint = document.getElementById('react-author-list');
      console.log('Checking if React component mounted...');
      // Check if the component was explicitly marked as mounted or still shows loading
      if (mountPoint && !mountPoint.dataset.mounted && mountPoint.querySelector('.react-loading')) {
        console.error("React component failed to mount after timeout");
        mountPoint.innerHTML = `
          <div class="error-container">
            <h2>Author List Component</h2>
            <p>This is the author list page that shows all authors in the system.</p>
            <div id="author-list-container">
              <p>Loading authors...</p>
            </div>
          </div>
        `;
        
        // Load authors directly from API
        fetch('/api/authors')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('author-list-container');
            if (container && data && data.authors) {
              let html = '<ul class="author-list">';
              data.authors.forEach(author => {
                html += `<li>${author.name || 'Unknown'}</li>`;
              });
              html += '</ul>';
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p>No authors found</p>';
            }
          })
          .catch(error => {
            console.error("Error loading authors:", error);
            const container = document.getElementById('author-list-container');
            if (container) {
              container.innerHTML = '<p>Error loading authors</p>';
            }
          });
      }
    }, 5000); // 5 second timeout
  </script>
</body>
</html>
