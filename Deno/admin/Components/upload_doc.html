<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Submission Form</title>
    <link rel="stylesheet" href="/admin/Components/css/upload_doc.css">
    <link rel="stylesheet" href="/admin/Components/css/side_bar.css">
    <link rel="stylesheet" href="/admin/Components/css/navbar_header.css">
    <link rel="stylesheet" href="/admin/Components/css/page_header.css">
    <!-- Add PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        /* Publication year fields styling */
        .publication-years .year-fields {
            display: flex;
            align-items: center;
            box-sizing: border-box;
            width: 100%;
        }
        
        .publication-years input[type="number"] {
            width: 50%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .year-separator {
            font-weight: bold;
            color: #555;
            padding: 0 4px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
  <nav class="side-bar">
        <div class="icon-container">

            <div class="top-group">
                
                    <div class="logo-icon">
                        <img src="/admin/Components/img/logo_2.png" alt="Logo-icon">
                        
                        <span class="logo-text">Office of Research & Publications </span>
                    
                    </div>
                    
                    
                    <a href="/admin/Components/upload_doc.html" class="upload-icon">
                        <div class="icon">
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-file-upload"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M12 11v6" /><path d="M9.5 13.5l2.5 -2.5l2.5 2.5" /></svg>
                        </div>
                        <span class="icon-text">Upload Document</span>
                    </a>
                
        
            </div>
            
            <div class="middle-group">
                
                <a href="/admin/dashboard.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-layout-dashboard"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 4h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1" /><path d="M5 16h4a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-2a1 1 0 0 1 1 -1" /><path d="M15 12h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1" /><path d="M15 4h4a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-2a1 1 0 0 1 1 -1" /></svg>
                    </div>
                    <span class="icon-text">Dashboard</span>
                </a>
                <a href="/admin/Components/documents_page.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-folders"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 3h3l2 2h5a2 2 0 0 1 2 2v7a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" /><path d="M17 16v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h2" /></svg>
                    </div>
                    <span class="icon-text">Documents List</span>
                </a>

                <a href="/admin/Components/author-list.html" class="icon-wrapper">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-users"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 7m-4 0a4 4 0 1 1 8 0a4 4 0 1 1 -8 0" /><path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /><path d="M21 21v-2a4 4 0 0 0 -3 -3.87" /></svg>
                    </div>
                    <span class="icon-text">Author List</span>
                </a>
            
                <a href="/admin/Components/Document-Permissions.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-lock-access"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 8v-2a2 2 0 0 1 2 -2h2" /><path d="M4 16v2a2 2 0 0 0 2 2h2" /><path d="M16 4h2a2 2 0 0 1 2 2v2" /><path d="M16 20h2a2 2 0 0 0 2 -2v-2" /><path d="M8 11m0 1a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1v3a1 1 0 0 1 -1 1h-6a1 1 0 0 1 -1 -1z" /><path d="M10 11v-2a2 2 0 1 1 4 0v2" /></svg>
                    </div>
                    <span class="icon-text">Document Permissions</span>
                </a>
                
            </div>

            
            <div class="bottom-group">
                
            
                <div class="user-profile">  <a href="/admin/profile.html" class="user-avatar-link"> <div class="user-icon">
                        <img src="/admin/Components/img/admin.jpg" alt="User Avatar">
                    </div>
                    </a>
                    <div class="user-details">  
                        <span class="user-name">Admin User</span>  
                        <span class="user-control">Admin</span>
                    </div>
                </div>
                
                <a href="/admin/Components/admin_logs.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-logs"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 12h.01" /><path d="M4 6h.01" /><path d="M4 18h.01" /><path d="M8 18h2" /><path d="M8 12h2" /><path d="M8 6h2" /><path d="M14 6h6" /><path d="M14 12h6" /><path d="M14 18h6" /></svg>
                    </div>
                    <span class="icon-text">System Logs</span>
                </a>

                <a href="admin_settings.html" class="icon-wrapper">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-settings"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z" /><path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" /></svg>
                    </div>
                    <span class="icon-text">Settings</span>
                </a>
                
                <a href="/logout" onclick="handleLogout(event)" class="icon-wrapper">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-logout-2"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 8v-2a2 2 0 0 1 2 -2h7a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-7a2 2 0 0 1 -2 -2v-2" /><path d="M15 12h-12l3 -3" /><path d="M6 15l-3 -3" /></svg>
                    </div>
                    <span class="icon-text">Logout</span>
                </a>
            </div>
        </div>
    </nav>
    <nav class="side-bar">
        <div class="icon-container">

            <div class="top-group">
                
                    <div class="logo-icon">
                        <img src="/admin/Components/img/logo_2.png" alt="Logo-icon">
                        
                        <span class="logo-text">Office of Research & Publications </span>
                    
                    </div>
                    
                    
                    <a href="/admin/Components/upload_doc.html" class="upload-icon">
                        <div class="icon">
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-file-upload"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M12 11v6" /><path d="M9.5 13.5l2.5 -2.5l2.5 2.5" /></svg>
                        </div>
                        <span class="icon-text">Upload Document</span>
                    </a>
                
        
            </div>
            
            <div class="middle-group">
                
                <a href="/admin/dashboard.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-layout-dashboard"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 4h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1" /><path d="M5 16h4a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-2a1 1 0 0 1 1 -1" /><path d="M15 12h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1" /><path d="M15 4h4a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1v-2a1 1 0 0 1 1 -1" /></svg>
                    </div>
                    <span class="icon-text">Dashboard</span>
                </a>
                <a href="/admin/Components/documents_page.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-folders"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 3h3l2 2h5a2 2 0 0 1 2 2v7a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" /><path d="M17 16v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h2" /></svg>
                    </div>
                    <span class="icon-text">Documents List</span>
                </a>

                <a href="/admin/Components/author-list.html" class="icon-wrapper">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-users"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 7m-4 0a4 4 0 1 1 8 0a4 4 0 1 1 -8 0" /><path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /><path d="M21 21v-2a4 4 0 0 0 -3 -3.87" /></svg>
                    </div>
                    <span class="icon-text">Author List</span>
                </a>
            
                <a href="/admin/Components/Document-Permissions.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-lock-access"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 8v-2a2 2 0 0 1 2 -2h2" /><path d="M4 16v2a2 2 0 0 0 2 2h2" /><path d="M16 4h2a2 2 0 0 1 2 2v2" /><path d="M16 20h2a2 2 0 0 0 2 -2v-2" /><path d="M8 11m0 1a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1v3a1 1 0 0 1 -1 1h-6a1 1 0 0 1 -1 -1z" /><path d="M10 11v-2a2 2 0 1 1 4 0v2" /></svg>
                    </div>
                    <span class="icon-text">Document Permissions</span>
                </a>
                
            </div>

            
            <div class="bottom-group">
                
            
                <div class="user-profile">  <a href="/admin/profile.html" class="user-avatar-link"> <div class="user-icon">
                        <img src="/admin/Components/img/admin.jpg" alt="User Avatar">
                    </div>
                    </a>
                    <div class="user-details">  
                        <span class="user-name">Admin User</span>  
                        <span class="user-control">Admin</span>
                    </div>
                </div>
                
                <a href="/admin/Components/admin_logs.html" class="icon-wrapper">
                    <div class="icon">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-logs"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 12h.01" /><path d="M4 6h.01" /><path d="M4 18h.01" /><path d="M8 18h2" /><path d="M8 12h2" /><path d="M8 6h2" /><path d="M14 6h6" /><path d="M14 12h6" /><path d="M14 18h6" /></svg>
                    </div>
                    <span class="icon-text">System Logs</span>
                </a>

                <a href="admin_settings.html" class="icon-wrapper">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-settings"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z" /><path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" /></svg>
                    </div>
                    <span class="icon-text">Settings</span>
                </a>
                
                <a href="/logout" onclick="handleLogout(event)" class="icon-wrapper">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-logout-2"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 8v-2a2 2 0 0 1 2 -2h7a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-7a2 2 0 0 1 -2 -2v-2" /><path d="M15 12h-12l3 -3" /><path d="M6 15l-3 -3" /></svg>
                    </div>
                    <span class="icon-text">Logout</span>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Navbar header with proper structure -->
    
  <!-- Navbar header with proper structure -->
  <div class="header">
    <div class="logo">
      <div class="logo-spud" style="background-image: url('/admin/Components/img/logo1.png');"></div>
      
      <div class="content">
        <span class="spud-text">St Paul University Dumaguete</span>
        <p>CARITAS VERITAS SCIENTIA</p> 
      </div>
    </div>
  </div>

            
            <div class="content">
                <span class="spud-text">St Paul University Dumaguete</span>
                <p>CARITAS VERITAS SCIENTIA</p> 
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="container">
            <div class="left-panel">
                <h2>Add New Document</h2>
                
                <div class="upload-mode-toggle">
                    <span>Upload Mode:</span>
                    <div class="toggle-buttons">
                        <button type="button" id="single-mode" class="toggle-btn active">Single Document</button>
                        <button type="button" id="compiled-mode" class="toggle-btn">Compiled Document</button>
                    </div>
                </div>
                
                <form id="upload-form" method="POST" enctype="multipart/form-data">
                    <div id="single-form-fields">
                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" id="title" name="title" required placeholder="Enter document title">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="authorInput">Author</label>
                                <div class="dropdown">
                                    <input type="text" id="authorInput" name="authorInput" placeholder="Type to search authors...">
                                    <div class="dropdown-list" id="authorList"></div>
                                </div>
                                <div class="select-container">
                                    <div class="selected-authors" id="selectedAuthors"></div>
                                </div>
                            </div>
                            <div class="form-group publication-years">
                                <label>Publication Year</label>
                                <div class="year-fields">
                                    <input type="number" id="start_year" name="start_year" required placeholder="Start Year" min="1900" max="2099">
                                    <span class="year-separator">to</span>
                                    <input type="number" id="end_year" name="end_year" required placeholder="End Year" min="1900" max="2099">
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="volume-no">Volume</label>
                                <input type="text" id="volume-no" name="volume-no" required placeholder="Enter volume number">
                            </div>
                            <div class="form-group" id="issued-no-container">
                                <label for="issued-no">Issued No.</label>
                                <input type="text" id="issued-no" name="issued-no" required placeholder="Enter issue number">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="topicInput">Research Agenda</label>
                                <div class="dropdown">
                                    <input type="text" id="topicInput" name="topicInput" placeholder="Type to search research agendas...">
                                    <div class="dropdown-list" id="topicList"></div>
                                </div>
                                <div class="select-container">
                                    <div class="selected-topics" id="selectedTopics"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select id="category" name="category" required>
                                    <option value="" disabled selected>Choose a category</option>
                                    <option value="thesis">Thesis</option>
                                    <option value="dissertation">Dissertation</option>
                                    <option value="confluence">Confluence</option>
                                    <option value="synergy">Synergy</option>
                                </select>
                            </div>
                        </div>

                        <div class="upload-icons-container">
                            <label for="file" class="upload-file">
                                <div class="upload-box">
                                    <!-- SVG for File Upload -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-paperclip"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5" /></svg>
                                    <p>Attach File</p>
                                </div>
                                <input type="file" id="file" name="file" accept=".pdf" style="display: none;" required>
                            </label>
                        </div>
                        
                        <div class="submit-container">
                            <button type="submit">SUBMIT</button>
                        </div>
                    </div>
                    
                    <div id="compiled-form-fields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group publication-years">
                                <label>Publication Year</label>
                                <div class="year-fields">
                                    <input type="number" id="compiled-start-year" name="compiled-start-year" required placeholder="Start Year" min="1900" max="2099">
                                    <span class="year-separator">to</span>
                                    <input type="number" id="compiled-end-year" name="compiled-end-year" required placeholder="End Year" min="1900" max="2099">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="compiled-volume">Volume</label>
                                <input type="text" id="compiled-volume" name="compiled-volume" required placeholder="Enter volume number">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" id="compiled-issued-no-container">
                                <label for="compiled-issued-no">Issued No.</label>
                                <input type="text" id="compiled-issued-no" name="compiled-issued-no" required placeholder="Enter issue number">
                            </div>
                            <div class="form-group">
                                <label for="compiled-category">Category</label>
                                <select id="compiled-category" name="compiled-category" required>
                                    <option value="" disabled selected>Choose a category</option>
                                    <option value="thesis">Thesis</option>
                                    <option value="dissertation">Dissertation</option>
                                    <option value="confluence">Confluence</option>
                                    <option value="synergy">Synergy</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="contents-section">
                            <h3>Contents Section</h3>
                            <div id="document-entries">
                                <div class="document-entry" data-index="1">
                                    <div class="preview-btn-container">
                                        <button type="button" class="preview-btn" data-index="1" disabled>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                        </button>
                                    </div>
                                
                                    <h4 class="research-number">Research 1</h4>
                                    
                                    <div class="entry-field">
                                        <label for="title-1">Study Title</label>
                                        <input type="text" id="title-1" class="doc-title" name="doc_titles[]" placeholder="Enter study title" required>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="author-1">Authors</label>
                                        <div class="dropdown">
                                            <input type="text" id="author-1" class="doc-author-input" name="doc_author_input[]" placeholder="Type to search authors...">
                                            <div class="dropdown-list doc-author-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-authors doc-selected-authors"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="agenda-1">Research Agenda</label>
                                        <div class="dropdown">
                                            <input type="text" id="agenda-1" class="doc-agenda-input" name="doc_agenda_input[]" placeholder="Type to search research agendas...">
                                            <div class="dropdown-list doc-agenda-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-agendas doc-selected-agendas"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="file-1">Attach File</label>
                                        <div class="file-upload-area" id="upload-area-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-paperclip"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5" /></svg>
                                            <p>Drag and drop your file here, or click to select a file</p>
                                            <input type="file" id="file-1" class="doc-file" name="doc_files[]" accept=".pdf" required>
                                            <div class="selected-file" id="file-name-1"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="document-entry" data-index="2">
                                    <div class="preview-btn-container">
                                        <button type="button" class="preview-btn" data-index="2" disabled>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                        </button>
                                    </div>
                                
                                    <h4 class="research-number">Research 2</h4>
                                    
                                    <div class="entry-field">
                                        <label for="title-2">Study Title</label>
                                        <input type="text" id="title-2" class="doc-title" name="doc_titles[]" placeholder="Enter study title" required>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="author-2">Authors</label>
                                        <div class="dropdown">
                                            <input type="text" id="author-2" class="doc-author-input" name="doc_author_input[]" placeholder="Type to search authors...">
                                            <div class="dropdown-list doc-author-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-authors doc-selected-authors"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="agenda-2">Research Agenda</label>
                                        <div class="dropdown">
                                            <input type="text" id="agenda-2" class="doc-agenda-input" name="doc_agenda_input[]" placeholder="Type to search research agendas...">
                                            <div class="dropdown-list doc-agenda-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-agendas doc-selected-agendas"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="file-2">Attach File</label>
                                        <div class="file-upload-area" id="upload-area-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-paperclip"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5" /></svg>
                                            <p>Drag and drop your file here, or click to select a file</p>
                                            <input type="file" id="file-2" class="doc-file" name="doc_files[]" accept=".pdf" required>
                                            <div class="selected-file" id="file-name-2"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="document-entry" data-index="3">
                                    <div class="preview-btn-container">
                                        <button type="button" class="preview-btn" data-index="3" disabled>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                        </button>
                                    </div>
                                
                                    <h4 class="research-number">Research 3</h4>
                                    
                                    <div class="entry-field">
                                        <label for="title-3">Study Title</label>
                                        <input type="text" id="title-3" class="doc-title" name="doc_titles[]" placeholder="Enter study title" required>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="author-3">Authors</label>
                                        <div class="dropdown">
                                            <input type="text" id="author-3" class="doc-author-input" name="doc_author_input[]" placeholder="Type to search authors...">
                                            <div class="dropdown-list doc-author-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-authors doc-selected-authors"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="agenda-3">Research Agenda</label>
                                        <div class="dropdown">
                                            <input type="text" id="agenda-3" class="doc-agenda-input" name="doc_agenda_input[]" placeholder="Type to search research agendas...">
                                            <div class="dropdown-list doc-agenda-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-agendas doc-selected-agendas"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="file-3">Attach File</label>
                                        <div class="file-upload-area" id="upload-area-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-paperclip"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5" /></svg>
                                            <p>Drag and drop your file here, or click to select a file</p>
                                            <input type="file" id="file-3" class="doc-file" name="doc_files[]" accept=".pdf" required>
                                            <div class="selected-file" id="file-name-3"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="document-entry" data-index="4">
                                    <div class="preview-btn-container">
                                        <button type="button" class="preview-btn" data-index="4" disabled>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                        </button>
                                    </div>
                                
                                    <h4 class="research-number">Research 4</h4>
                                    
                                    <div class="entry-field">
                                        <label for="title-4">Study Title</label>
                                        <input type="text" id="title-4" class="doc-title" name="doc_titles[]" placeholder="Enter study title" required>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="author-4">Authors</label>
                                        <div class="dropdown">
                                            <input type="text" id="author-4" class="doc-author-input" name="doc_author_input[]" placeholder="Type to search authors...">
                                            <div class="dropdown-list doc-author-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-authors doc-selected-authors"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="agenda-4">Research Agenda</label>
                                        <div class="dropdown">
                                            <input type="text" id="agenda-4" class="doc-agenda-input" name="doc_agenda_input[]" placeholder="Type to search research agendas...">
                                            <div class="dropdown-list doc-agenda-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-agendas doc-selected-agendas"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="file-4">Attach File</label>
                                        <div class="file-upload-area" id="upload-area-4">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-paperclip"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5" /></svg>
                                            <p>Drag and drop your file here, or click to select a file</p>
                                            <input type="file" id="file-4" class="doc-file" name="doc_files[]" accept=".pdf" required>
                                            <div class="selected-file" id="file-name-4"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="document-entry" data-index="5">
                                    <div class="preview-btn-container">
                                        <button type="button" class="preview-btn" data-index="5" disabled>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                        </button>
                                    </div>
                                
                                    <h4 class="research-number">Research 5</h4>
                                    
                                    <div class="entry-field">
                                        <label for="title-5">Study Title</label>
                                        <input type="text" id="title-5" class="doc-title" name="doc_titles[]" placeholder="Enter study title" required>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="author-5">Authors</label>
                                        <div class="dropdown">
                                            <input type="text" id="author-5" class="doc-author-input" name="doc_author_input[]" placeholder="Type to search authors...">
                                            <div class="dropdown-list doc-author-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-authors doc-selected-authors"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="agenda-5">Research Agenda</label>
                                        <div class="dropdown">
                                            <input type="text" id="agenda-5" class="doc-agenda-input" name="doc_agenda_input[]" placeholder="Type to search research agendas...">
                                            <div class="dropdown-list doc-agenda-list"></div>
                                        </div>
                                        <div class="select-container">
                                            <div class="selected-agendas doc-selected-agendas"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="entry-field">
                                        <label for="file-5">Attach File</label>
                                        <div class="file-upload-area" id="upload-area-5">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-paperclip"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5" /></svg>
                                            <p>Drag and drop your file here, or click to select a file</p>
                                            <input type="file" id="file-5" class="doc-file" name="doc_files[]" accept=".pdf" required>
                                            <div class="selected-file" id="file-name-5"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="submit-container">
                            <button type="submit">SUBMIT</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="right-panel">
                <div class="preview-header">
                    <h2>Preview</h2>
                </div>
                <div class="preview-content">
                    <div class="preview-header-content">
                        <img id="category-icon" src="icons/Category-icons/default_category_icon.png" alt="Category Icon" class="category-icon">
                        <div class="title-author-container">
                            <p><strong id="preview-title">Title of Document</strong></p>
                            <p id="preview-author">by Author Name</p>
                        </div>
                    </div>
                    
                    <p id="preview-year">Publishing Date: 2021</p>
                    <p id="preview-topic">Research Agenda: History</p>
                    
                    <p id="preview-pages">Pages: <span id="page-count">0</span></p>
                    <p id="preview-added-date">Added Date: January 15, 2021</p>

                    <div class="read-document-container">
                        <button id="read-document" class="disabled-button" disabled>Read Document</button>
                    </div>

                    <div class="abstract-preview">
                        <p><strong>Abstract</strong></p>
                        <div class="abstract-content">
                            <p id="preview-abstract">Abstract will be extracted from the PDF file.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Popup Modal -->
    <div id="success-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
                <path fill="#4caf50" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"></path>
                <path fill="#ccff90" d="M34.602,14.602L21,28.199l-5.602-5.598l-2.797,2.797L21,33.801l16.398-16.402L34.602,14.602z"></path>
            </svg>
            <h2>Uploaded successfully!</h2>
            <p>Your document has been uploaded successfully.</p>
        </div>
    </div>

    <!-- Receipt Popup Modal -->
    <div id="receipt-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content document-preview">
            <div class="document-preview-container">
                <div class="document-icon">
                    <img id="receipt-category-icon" src="icons/Category-icons/default_category_icon.png" alt="Category Icon">
                </div>
                <div class="document-details">
                    <h2 id="receiptTitle" class="document-title">Document_title</h2>
                    
                    <div class="document-metadata">
                        <div class="author-badge" id="receiptAuthor">Document_Author</div>
                        <div class="category-badge" id="receiptCategory">Category</div>
                    </div>
                    
                    <div class="document-topics" id="receiptTopics">
                        <!-- Topics will be added dynamically -->
                    </div>

                    <div class="additional-info">
                        <p>Upload Date: <span id="receiptDate"></span></p>
                        <p>Volume: <span id="receiptVolume"></span></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-receipt" class="close-btn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Category change handler for Issued No. field
        document.getElementById('category').addEventListener('change', function() {
            updateIssuedNoField(this.value, 'issued-no-container');
        });
        
        document.getElementById('compiled-category').addEventListener('change', function() {
            updateIssuedNoField(this.value, 'compiled-issued-no-container');
        });
        
        function updateIssuedNoField(categoryValue, containerId) {
            const issuedContainer = document.getElementById(containerId);
            const fieldId = containerId === 'issued-no-container' ? 'issued-no' : 'compiled-issued-no';
            
            // Store the current value if the field exists
            let currentValue = '';
            const currentField = document.getElementById(fieldId);
            if (currentField) {
                currentValue = currentField.value;
            }
            
            if (categoryValue === 'synergy') {
                issuedContainer.innerHTML = `
                    <label for="${fieldId}">Issued No.</label>
                    <select id="${fieldId}" name="${fieldId}" required>
                        <option value="" disabled selected>Select department</option>
                        <option value="CBIT">College of Business in Information Technology</option>
                        <option value="CASE">College of Arts and Science Education</option>
                        <option value="CONS">College of Nursing</option>
                        <option value="BAED">Basic Academic Education</option>
                    </select>
                `;
                
                // If there was a previous value, try to select it in the dropdown
                const newSelect = document.getElementById(fieldId);
                if (currentValue && newSelect) {
                    // Try to find and select the option with the matching value
                    const option = Array.from(newSelect.options).find(opt => opt.value === currentValue);
                    if (option) {
                        option.selected = true;
                    }
                }
            } else {
                issuedContainer.innerHTML = `
                    <label for="${fieldId}">Issued No.</label>
                    <input type="text" id="${fieldId}" name="${fieldId}" required placeholder="Enter issue number" value="${currentValue}">
                `;
            }
            
            // Log the updated field for debugging
            console.log(`Updated ${fieldId} with value: ${currentValue}`);
        }
        
        // Upload mode toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const singleModeBtn = document.getElementById('single-mode');
            const compiledModeBtn = document.getElementById('compiled-mode');
            const fileInput = document.getElementById('file');
            
            // Global variable for upload mode
            window.uploadMode = 'single';
            
            // Event listeners for mode buttons
            singleModeBtn.addEventListener('click', function() {
                setUploadMode('single');
            });
            
            compiledModeBtn.addEventListener('click', function() {
                setUploadMode('compiled');
            });
            
            // Initialize document entries
            document.querySelectorAll('.document-entry').forEach(entry => {
                initFileUploadListeners(entry);
                initAuthorSearch(entry);
                initAgendaSearch(entry);
            });
            
            // Initialize form fields that might need special handling
            document.querySelectorAll('select[id$="-category"]').forEach(select => {
                select.addEventListener('change', function() {
                    const containerId = this.id === 'category' ? 'issued-no-container' : 'compiled-issued-no-container';
                    updateIssuedNoField(this.value, containerId);
                });
            });
            
            // Make sure we have the correct issue fields initially
            updateIssuedNoField(document.getElementById('category').value, 'issued-no-container');
            updateIssuedNoField(document.getElementById('compiled-category').value, 'compiled-issued-no-container');

            // Set initial mode on page load - make compiled form not visible or required
            const compiledFormFields = document.getElementById('compiled-form-fields');
            if (compiledFormFields) {
                // Set display to none
                compiledFormFields.style.display = 'none';
                
                // Remove required attribute from all fields in compiled form
                compiledFormFields.querySelectorAll('[required]').forEach(field => {
                    field.dataset.required = 'true';
                    field.removeAttribute('required');
                });
            }
            
            // Set up form submission handler
            document.getElementById('upload-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Handle form submission based on mode
                if (window.uploadMode === 'single') {
                    handleSingleModeSubmit(this);
                } else {
                    handleCompiledModeSubmit(this);
                }
            });
            
            // Set initial mode
            setUploadMode('single');
        });
        
        // Function to set upload mode
        function setUploadMode(mode) {
            // Update global mode
            window.uploadMode = mode;
            
            // Get UI elements
            const singleModeBtn = document.getElementById('single-mode');
            const compiledModeBtn = document.getElementById('compiled-mode');
            const singleFormFields = document.getElementById('single-form-fields');
            const compiledFormFields = document.getElementById('compiled-form-fields');
            
            if (mode === 'single') {
                // Update UI
                singleModeBtn.classList.add('active');
                compiledModeBtn.classList.remove('active');
                singleFormFields.style.display = 'block';
                compiledFormFields.style.display = 'none';
                
                // Update form fields - enable required attributes for single form
                singleFormFields.querySelectorAll('[data-required]').forEach(field => {
                    field.setAttribute('required', '');
                });
                
                // Remove required attributes from compiled form 
                compiledFormFields.querySelectorAll('[required]').forEach(field => {
                    field.dataset.required = 'true';
                    field.removeAttribute('required');
                });
                
                // Update category options for single mode
                const singleCategory = document.getElementById('category');
                singleCategory.innerHTML = `
                    <option value="" disabled selected>Choose a category</option>
                    <option value="thesis">Thesis</option>
                    <option value="dissertation">Dissertation</option>
                `;
            } else {
                // Update UI
                singleModeBtn.classList.remove('active');
                compiledModeBtn.classList.add('active');
                singleFormFields.style.display = 'none';
                compiledFormFields.style.display = 'block';
                
                // Update form fields - remove required attributes from single form
                singleFormFields.querySelectorAll('[required]').forEach(field => {
                    field.dataset.required = 'true';
                    field.removeAttribute('required');
                });
                
                // Enable required attributes for compiled form
                compiledFormFields.querySelectorAll('[data-required]').forEach(field => {
                    field.setAttribute('required', '');
                });
                
                // Update category options for compiled mode
                const compiledCategory = document.getElementById('compiled-category');
                compiledCategory.innerHTML = `
                    <option value="" disabled selected>Choose a category</option>
                    <option value="confluence">Confluence</option>
                    <option value="synergy">Synergy</option>
                `;
            }
            
            // Maintain consistent container height regardless of mode
            const container = document.querySelector('.container');
            if (container) {
                container.style.maxHeight = '80vh';
                container.style.overflow = 'hidden';
            }
            
            // Reset left panel scrollbar position when switching modes
            const leftPanel = document.querySelector('.left-panel');
            if (leftPanel) {
                leftPanel.scrollTop = 0;
            }
        }
        
        // Handle single mode form submission
        function handleSingleModeSubmit(form) {
            // Create FormData
            const formData = new FormData(form);
            
            // Add upload mode
            formData.append('upload_mode', 'single');
            
            // Handle publication year fields
            const startYear = document.getElementById('start_year').value;
            const endYear = document.getElementById('end_year').value;
            
            // Create a combined publication year string
            if (startYear && endYear) {
                // Delete individual year fields
                formData.delete('start_year');
                formData.delete('end_year');
                
                // Add combined publication year field
                formData.append('publication_date', `${startYear}-${endYear}`);
            }
            
            // Store issued-no value
            const issuedNoValue = document.getElementById('issued-no').value;
            console.log("Single mode issued no value:", issuedNoValue);
            
            // Client-side validation
            const fileInput = document.getElementById('file');
            const title = document.getElementById('title').value;
            const category = document.getElementById('category').value;
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Please select a file to upload.');
                return;
            }
            
            if (!title) {
                alert('Please enter a document title.');
                return;
            }
            
            if (!category) {
                alert('Please select a category.');
                return;
            }
            
            if (!startYear || !endYear) {
                alert('Please enter both start and end publication years.');
                return;
            }
            
            // Ensure issued-no is included correctly
            if (issuedNoValue && !formData.has('issued-no')) {
                formData.append('issued-no', issuedNoValue);
            }
            
            // Output form data for debugging
            for (let [key, value] of formData.entries()) {
                console.log(`${key}: ${value}`);
            }
            
            // Submit form
            submitForm(formData);
        }
        
        // Handle compiled mode form submission
        function handleCompiledModeSubmit(form) {
            // Create FormData
            const formData = new FormData(form);
            
            // Add upload mode
            formData.append('upload_mode', 'compiled');
            
            // Handle publication year fields
            const startYear = document.getElementById('compiled-start-year').value;
            const endYear = document.getElementById('compiled-end-year').value;
            
            // Create a combined publication year string
            if (startYear && endYear) {
                // Keep the individual year fields (don't delete them)
                // The backend needs these individual fields
                
                // Also add combined publication year field for backward compatibility
                formData.append('compiled-publication-year', `${startYear}-${endYear}`);
            }
            
            // Store issued-no value
            const issuedNoValue = document.getElementById('compiled-issued-no').value;
            console.log("Compiled mode issued no value:", issuedNoValue);
            
            // Remove single file if present
            if (formData.has('file')) {
                formData.delete('file');
            }
            
            // Get document entries
            const docEntries = Array.from(document.querySelectorAll('.document-entry'));
            
            // Validate entries
            if (docEntries.length === 0) {
                alert('Please add at least one document to the contents section.');
                return;
            }
            
            // Check if all entries have files
            let allFilesSelected = true;
            docEntries.forEach((entry, index) => {
                const fileInput = entry.querySelector('.doc-file');
                if (!fileInput.files || fileInput.files.length === 0) {
                    allFilesSelected = false;
                }
            });
            
            if (!allFilesSelected) {
                alert('Please attach a file to each document in the contents section.');
                return;
            }
            
            if (!startYear || !endYear) {
                alert('Please enter both start and end publication years.');
                return;
            }
            
            // Ensure issued-no is included correctly
            if (issuedNoValue && !formData.has('compiled-issued-no')) {
                formData.append('compiled-issued-no', issuedNoValue);
            }
            
            // Output form data for debugging
            for (let [key, value] of formData.entries()) {
                console.log(`${key}: ${value}`);
            }
            
            // Submit form
            submitForm(formData);
        }
        
        // Submit form via AJAX
        function submitForm(formData) {
            fetch('/api/upload-document', {
                method: 'POST',
                body: formData,
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    document.getElementById('success-modal').style.display = 'flex';
                    setTimeout(() => {
                        document.getElementById('success-modal').style.display = 'none';
                        // Show receipt
                        showReceipt(data);
                    }, 2000);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred during upload.');
            });
        }
        
        // Function to show the receipt after a successful upload
        function showReceipt(data) {
            // Get receipt elements
            const receiptTitle = document.getElementById('receiptTitle');
            const receiptAuthor = document.getElementById('receiptAuthor');
            const receiptCategory = document.getElementById('receiptCategory');
            const receiptDate = document.getElementById('receiptDate');
            const receiptVolume = document.getElementById('receiptVolume');
            const receiptTopics = document.getElementById('receiptTopics');
            const receiptCategoryIcon = document.getElementById('receipt-category-icon');
            
            // Set receipt content
            if (receiptTitle) receiptTitle.textContent = data.title || 'Document Title';
            if (receiptAuthor) receiptAuthor.textContent = Array.isArray(data.authors) ? data.authors.join(', ') : data.author || 'Author';
            if (receiptCategory) receiptCategory.textContent = data.category || 'Category';
            
            // Set date
            if (receiptDate) {
                const currentDate = new Date();
                receiptDate.textContent = currentDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
            
            // Set volume
            if (receiptVolume) receiptVolume.textContent = data.volume || 'N/A';
            
            // Set category icon
            if (receiptCategoryIcon && data.category) {
                const iconPath = getCategoryIcon(data.category);
                receiptCategoryIcon.src = iconPath;
            }
            
            // Set topics
            if (receiptTopics) {
                receiptTopics.innerHTML = '';
                const topics = Array.isArray(data.topics) ? data.topics : [];
                
                topics.forEach(topic => {
                    const topicBadge = document.createElement('span');
                    topicBadge.classList.add('topic-badge');
                    topicBadge.textContent = topic;
                    receiptTopics.appendChild(topicBadge);
                });
            }
            
            // Show the receipt modal
            const receiptModal = document.getElementById('receipt-modal');
            if (receiptModal) {
                receiptModal.style.display = 'flex';
            }
            
            // Add close button event listener if it doesn't exist
            const closeButton = document.getElementById('close-receipt');
            if (closeButton) {
                // Remove existing listeners to prevent duplicates
                const newCloseButton = closeButton.cloneNode(true);
                closeButton.parentNode.replaceChild(newCloseButton, closeButton);
                
                // Add new listener
                newCloseButton.addEventListener('click', () => {
                    receiptModal.style.display = 'none';
                });
            }
        }
        
        // Handle file upload UI
        function initFileUploadListeners(entryElement) {
            const index = entryElement.dataset.index;
            const fileInput = entryElement.querySelector('.doc-file');
            const fileNameDisplay = entryElement.querySelector(`#file-name-${index}`);
            const uploadArea = entryElement.querySelector(`#upload-area-${index}`);
            const previewBtn = entryElement.querySelector('.preview-btn');
            
            // Handle drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                uploadArea.style.borderColor = '#0a5e43';
                uploadArea.style.backgroundColor = '#f0f9f6';
            }
            
            function unhighlight() {
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = '#fafafa';
            }
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    fileInput.files = files;
                    updateFileInfo(files[0]);
                }
            }
            
            fileInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    updateFileInfo(this.files[0]);
                }
            });
            
            function updateFileInfo(file) {
                fileNameDisplay.textContent = `Selected: ${file.name}`;
                fileNameDisplay.style.display = 'block';
                
                // Enable the preview button
                previewBtn.removeAttribute('disabled');
                
                // Add file to preview data
                previewFiles[index] = {
                    file: file,
                    title: entryElement.querySelector('.doc-title').value || `Research ${index}`,
                    authors: Array.from(entryElement.querySelectorAll('.selected-author')).map(el => el.textContent.replace(' ×', ''))
                };
            }
            
            // Listen for title changes to update preview data
            entryElement.querySelector('.doc-title').addEventListener('input', function() {
                const researchIndex = entryElement.dataset.index;
                if (previewFiles[researchIndex]) {
                    previewFiles[researchIndex].title = this.value || `Research ${researchIndex}`;
                }
            });
        }
        
        // Preview functionality
        const previewFiles = {};
        
        // Fix for preview buttons - improved implementation
        document.querySelectorAll('.preview-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const researchIndex = this.dataset.index;
                if (previewFiles[researchIndex]) {
                    showPreview(researchIndex);
                } else {
                    // If no file selected yet, show a message
                    alert('Please select a file first to preview.');
                }
            });
        });
        
        function showPreview(index) {
            const previewData = previewFiles[index];
            if (!previewData) return;
            
            // Update preview elements
            document.getElementById('preview-title').textContent = previewData.title;
            document.getElementById('preview-author').textContent = previewData.authors.length > 0 ? 
                `by ${previewData.authors.join(', ')}` : 'by Unknown Author';
            
            // Get the current date for the added date field
            const currentDate = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('preview-added-date').textContent = 'Added Date: ' + currentDate.toLocaleDateString('en-US', options);
            
            // Read the PDF file for preview
            const file = previewData.file;
            const fileReader = new FileReader();
            
            fileReader.onload = function() {
                const typedarray = new Uint8Array(this.result);
                
                // Load PDF using PDF.js
                pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                    // Update page count
                    document.getElementById('page-count').textContent = pdf.numPages;
                    
                    // Get the first page to extract abstract
                    return pdf.getPage(1);
                }).then(page => {
                    // Get text content of first page
                    return page.getTextContent();
                }).then(textContent => {
                    // Extract text from the first page (simplified "abstract")
                    const text = textContent.items.map(item => item.str).join(' ');
                    const abstractText = text.substring(0, 300) + '...';
                    document.getElementById('preview-abstract').textContent = abstractText;
                    
                    // Enable read document button
                    const readBtn = document.getElementById('read-document');
                    readBtn.classList.remove('disabled-button');
                    readBtn.removeAttribute('disabled');
                    
                    // Scroll to view the preview panel on small screens
                    const rightPanel = document.querySelector('.right-panel');
                    if (window.innerWidth < 1200) {
                        rightPanel.scrollIntoView({ behavior: 'smooth' });
                    }
                }).catch(error => {
                    console.error('Error loading PDF:', error);
                    document.getElementById('preview-abstract').textContent = 'Failed to load PDF preview.';
                });
            };
            
            fileReader.readAsArrayBuffer(file);
        }
        
        // Contents Section functionality
        const documentEntries = document.getElementById('document-entries');
        
        // Initialize author search for all entries
        document.querySelectorAll('.document-entry').forEach(entry => {
            initAuthorSearch(entry);
            initAgendaSearch(entry);
            initFileUploadListeners(entry);
        });
        
        // Function to initialize author search for document entries
        function initAuthorSearch(entryElement) {
            const authorInput = entryElement.querySelector('.doc-author-input');
            const authorList = entryElement.querySelector('.doc-author-list');
            const selectedAuthorsContainer = entryElement.querySelector('.doc-selected-authors');
            const selectedAuthors = new Set();
            let searchTimeout;
            
            if (!authorInput || !authorList) return;
            
            // Debounce function for search
            const debounce = (func, delay) => {
                return function() {
                    const context = this;
                    const args = arguments;
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        func.apply(context, args);
                    }, delay);
                };
            };
            
            // Actual search function
            const performSearch = async (query) => {
                if (query.length === 0) {
                    authorList.innerHTML = "";
                    authorList.style.display = "none";
                    return;
                }
                
                authorList.innerHTML = "<div class='dropdown-item'>Searching...</div>";
                authorList.style.display = "block";
                
                try {
                    const response = await fetch(`/api/authors?q=${encodeURIComponent(query)}`, {
                        credentials: 'include'
                    });
                    console.log("Author search response status:", response.status);
                    
                    const data = await response.json();
                    console.log("Author search data:", data);
                    
                    displayAuthorResults(data);
                } catch (error) {
                    console.error("Error fetching authors:", error);
                    authorList.innerHTML = "<div class='dropdown-item text-danger'>Error fetching authors</div>";
                }
            };
            
            // Create debounced search function (400ms delay)
            const debouncedSearch = debounce(performSearch, 400);
            
            // Add input event listener with debounced search
            authorInput.addEventListener("input", function() {
                const query = this.value.trim();
                debouncedSearch(query);
            });
            
            function displayAuthorResults(data) {
                authorList.innerHTML = ""; // Clear previous list
                
                if (!Array.isArray(data)) {
                    console.error("Unexpected API response:", data);
                    authorList.innerHTML = "<div class='dropdown-item text-danger'>Unexpected response</div>";
                    return;
                }
                
                if (data.length === 0) {
                    // If no authors found, show option to create new author
                    authorList.innerHTML = `
                        <div class='dropdown-item create-author' onclick="createNewAuthor('${authorInput.value.trim()}', this)">
                            <span class="create-author-text">Add: "${authorInput.value.trim()}"</span>
                        </div>`;
                } else {
                    data.forEach(author => {
                        console.log("Author data:", author);
                        const authorName = author.full_name || author.name || author.author_name || "Unknown Author";
                        const authorItem = document.createElement("div");
                        authorItem.textContent = authorName;
                        authorItem.classList.add("dropdown-item");
                        // Add explicit styling to ensure visibility
                        authorItem.style.padding = "8px 12px";
                        authorItem.style.cursor = "pointer";
                        authorItem.style.backgroundColor = "#fff";
                        authorItem.style.color = "#333";
                        authorItem.addEventListener("click", () => {
                            if (!selectedAuthors.has(authorName)) {
                                selectedAuthors.add(authorName);
                                updateSelectedAuthors();
                            }
                            authorInput.value = ""; // Clear input after selection
                            authorList.innerHTML = ""; // Hide dropdown list
                            authorList.style.display = "none";
                        });
                        authorList.appendChild(authorItem);
                    });
                    
                    // Also add option to create new author if not in the list
                    const createNewAuthorItem = document.createElement("div");
                    createNewAuthorItem.classList.add("dropdown-item", "create-author");
                    createNewAuthorItem.innerHTML = `<span class="create-author-text">Add: "${authorInput.value.trim()}"</span>`;
                    createNewAuthorItem.addEventListener("click", () => {
                        if (!selectedAuthors.has(authorInput.value.trim())) {
                            selectedAuthors.add(authorInput.value.trim());
                            updateSelectedAuthors();
                        }
                        authorInput.value = ""; // Clear input after selection
                        authorList.innerHTML = ""; // Hide dropdown list
                        authorList.style.display = "none";
                    });
                    authorList.appendChild(createNewAuthorItem);
                }
            }
            
            // Close author list when clicking outside
            document.addEventListener('click', function(e) {
                if (!authorInput.contains(e.target) && !authorList.contains(e.target)) {
                    authorList.innerHTML = "";
                    authorList.style.display = "none";
                }
            });
            
            // Create new author handler
            window.createNewAuthor = function(authorName, element) {
                // Find the closest document entry
                const entry = element.closest('.document-entry');
                if (!entry) return;
                
                const selectedAuthorsEl = entry.querySelector('.doc-selected-authors');
                const authorSet = selectedAuthorsEl.dataset.authors ? 
                    new Set(JSON.parse(selectedAuthorsEl.dataset.authors)) : new Set();
                
                if (!authorSet.has(authorName)) {
                    authorSet.add(authorName);
                    updateAuthorList(selectedAuthorsEl, authorSet);
                }
                
                // Clear input and dropdown
                const input = entry.querySelector('.doc-author-input');
                const list = entry.querySelector('.doc-author-list');
                if (input) input.value = "";
                if (list) {
                    list.innerHTML = "";
                    list.style.display = "none";
                }
            };
            
            function updateSelectedAuthors() {
                selectedAuthorsContainer.innerHTML = ""; // Clear previous selections
                selectedAuthorsContainer.dataset.authors = JSON.stringify(Array.from(selectedAuthors));
                
                selectedAuthors.forEach(name => {
                    const authorDiv = document.createElement("div");
                    authorDiv.classList.add("selected-author");
                    authorDiv.textContent = name;
                    
                    // Add remove button
                    const removeBtn = document.createElement("span");
                    removeBtn.textContent = " ×";
                    removeBtn.classList.add("remove-author");
                    removeBtn.addEventListener("click", () => {
                        selectedAuthors.delete(name);
                        updateSelectedAuthors();
                    });
                    
                    authorDiv.appendChild(removeBtn);
                    selectedAuthorsContainer.appendChild(authorDiv);
                    
                    // Add hidden input for form submission
                    const hiddenInput = document.createElement("input");
                    hiddenInput.type = "hidden";
                    hiddenInput.name = "doc_authors[]";
                    hiddenInput.value = name;
                    selectedAuthorsContainer.appendChild(hiddenInput);
                });
                
                // Update the preview data if we have a file selected
                const researchIndex = entryElement.dataset.index;
                if (previewFiles[researchIndex]) {
                    previewFiles[researchIndex].authors = Array.from(selectedAuthors);
                }
            }
        }
        
        function updateAuthorList(container, authorSet) {
            container.innerHTML = ""; // Clear previous selections
            container.dataset.authors = JSON.stringify(Array.from(authorSet));
            
            authorSet.forEach(name => {
                const authorDiv = document.createElement("div");
                authorDiv.classList.add("selected-author");
                authorDiv.textContent = name;
                
                // Add remove button
                const removeBtn = document.createElement("span");
                removeBtn.textContent = " ×";
                removeBtn.classList.add("remove-author");
                removeBtn.addEventListener("click", () => {
                    authorSet.delete(name);
                    updateAuthorList(container, authorSet);
                });
                
                authorDiv.appendChild(removeBtn);
                container.appendChild(authorDiv);
                
                // Add hidden input for form submission
                const hiddenInput = document.createElement("input");
                hiddenInput.type = "hidden";
                hiddenInput.name = "doc_authors[]";
                hiddenInput.value = name;
                container.appendChild(hiddenInput);
            });
            
            // Update the preview data if we have a file selected
            const entry = container.closest('.document-entry');
            if (entry) {
                const researchIndex = entry.dataset.index;
                if (previewFiles[researchIndex]) {
                    previewFiles[researchIndex].authors = Array.from(authorSet);
                }
            }
        }
        
        // Function to initialize research agenda search
        function initAgendaSearch(entryElement) {
            const agendaInput = entryElement.querySelector('.doc-agenda-input');
            const agendaList = entryElement.querySelector('.doc-agenda-list');
            const selectedAgendasContainer = entryElement.querySelector('.doc-selected-agendas');
            const selectedAgendas = new Set();
            let searchTimeout;
            
            if (!agendaInput || !agendaList || !selectedAgendasContainer) return;
            
            // Debounce function for search
            const debounce = (func, delay) => {
                return function() {
                    const context = this;
                    const args = arguments;
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        func.apply(context, args);
                    }, delay);
                };
            };
            
            // Actual search function
            const performSearch = async (query) => {
                if (query.length === 0) {
                    agendaList.innerHTML = "";
                    agendaList.style.display = "none";
                    return;
                }
                
                agendaList.innerHTML = "<div class='dropdown-item'>Searching...</div>";
                agendaList.style.display = "block";
                
                try {
                    const response = await fetch(`/api/topics?q=${encodeURIComponent(query)}`, {
                        credentials: 'include'
                    });
                    const data = await response.json();
                    
                    displayAgendaResults(data);
                } catch (error) {
                    console.error("Error fetching research agendas:", error);
                    agendaList.innerHTML = "<div class='dropdown-item text-danger'>Error fetching research agendas</div>";
                }
            };
            
            // Create debounced search function (400ms delay)
            const debouncedSearch = debounce(performSearch, 400);
            
            // Add input event listener with debounced search
            agendaInput.addEventListener("input", function() {
                const query = this.value.trim();
                debouncedSearch(query);
            });
            
            function displayAgendaResults(data) {
                agendaList.innerHTML = ""; // Clear previous list
                
                if (!Array.isArray(data)) {
                    console.error("Unexpected API response:", data);
                    agendaList.innerHTML = "<div class='dropdown-item text-danger'>Unexpected response</div>";
                    return;
                }
                
                if (data.length === 0) {
                    // If no agendas found, show option to create new agenda
                    const createAgendaItem = document.createElement("div");
                    createAgendaItem.classList.add("dropdown-item", "create-agenda");
                    createAgendaItem.innerHTML = `<span class="create-agenda-text">Add: "${agendaInput.value.trim()}"</span>`;
                    createAgendaItem.addEventListener("click", () => {
                        if (!selectedAgendas.has(agendaInput.value.trim())) {
                            selectedAgendas.add(agendaInput.value.trim());
                            updateSelectedAgendas();
                        }
                        agendaInput.value = ""; // Clear input after selection
                        agendaList.innerHTML = ""; // Hide dropdown list
                        agendaList.style.display = "none";
                    });
                    agendaList.appendChild(createAgendaItem);
                } else {
                    // Display found agendas
                    data.forEach(agenda => {
                        const agendaItem = document.createElement("div");
                        agendaItem.textContent = agenda.topic_name;
                        agendaItem.classList.add("dropdown-item");
                        agendaItem.addEventListener("click", () => {
                            if (!selectedAgendas.has(agenda.topic_name)) {
                                selectedAgendas.add(agenda.topic_name);
                                updateSelectedAgendas();
                            }
                            agendaInput.value = ""; // Clear input after selection
                            agendaList.innerHTML = ""; // Hide dropdown list
                            agendaList.style.display = "none";
                        });
                        agendaList.appendChild(agendaItem);
                    });
                    
                    // Always add option to add new agenda
                    const createAgendaItem = document.createElement("div");
                    createAgendaItem.classList.add("dropdown-item", "create-agenda");
                    createAgendaItem.innerHTML = `<span class="create-agenda-text">Add: "${agendaInput.value.trim()}"</span>`;
                    createAgendaItem.addEventListener("click", () => {
                        if (!selectedAgendas.has(agendaInput.value.trim())) {
                            selectedAgendas.add(agendaInput.value.trim());
                            updateSelectedAgendas();
                        }
                        agendaInput.value = ""; // Clear input after selection
                        agendaList.innerHTML = ""; // Hide dropdown list
                        agendaList.style.display = "none";
                    });
                    agendaList.appendChild(createAgendaItem);
                }
            }
            
            // Close agenda list when clicking outside
            document.addEventListener('click', function(e) {
                if (!agendaInput.contains(e.target) && !agendaList.contains(e.target)) {
                    agendaList.innerHTML = "";
                    agendaList.style.display = "none";
                }
            });
            
            function updateSelectedAgendas() {
                selectedAgendasContainer.innerHTML = ""; // Clear previous selections
                
                selectedAgendas.forEach(name => {
                    const agendaDiv = document.createElement("div");
                    agendaDiv.classList.add("selected-agenda");
                    agendaDiv.textContent = name;
                    
                    // Add remove button
                    const removeBtn = document.createElement("span");
                    removeBtn.textContent = " ×";
                    removeBtn.classList.add("remove-agenda");
                    removeBtn.addEventListener("click", () => {
                        selectedAgendas.delete(name);
                        updateSelectedAgendas();
                    });
                    
                    agendaDiv.appendChild(removeBtn);
                    selectedAgendasContainer.appendChild(agendaDiv);
                    
                    // Add hidden input for form submission
                    const hiddenInput = document.createElement("input");
                    hiddenInput.type = "hidden";
                    hiddenInput.name = "doc_agenda[]";
                    hiddenInput.value = name;
                    selectedAgendasContainer.appendChild(hiddenInput);
                });
                
                // Update the research_agenda field for this entry
                const researchIndex = entryElement.dataset.index;
                if (previewFiles[researchIndex]) {
                    previewFiles[researchIndex].agendas = Array.from(selectedAgendas);
                }
            }
        }
    </script>
    <script src="/admin/Components/js/side_bar.js"></script>
    <script src="/admin/Components/js/get-author.js"></script>
    <script src="/admin/Components/js/get-topics.js"></script>
    <script type="module" src="/admin/Components/js/upload.js"></script>
    <script src="/admin/Components/js/category-icon.js"></script>

    <!-- Fix for view buttons and scrolling -->
    <script>
        // Run after page is fully loaded
        window.addEventListener('load', function() {
            // Fix container layout to ensure Research 5 is not cut off
            const leftPanel = document.querySelector('.left-panel');
            const uploadForm = document.getElementById('upload-form');
            const singleFormFields = document.getElementById('single-form-fields');
            const compiledFormFields = document.getElementById('compiled-form-fields');
            const contentsSection = document.querySelector('.contents-section');
            const documentEntries = document.querySelector('#document-entries');
            
            // Fix container overflow and height
            const container = document.querySelector('.container');
            if (container) {
                container.style.maxHeight = '80vh';
                container.style.overflow = 'hidden';
            }
            
            if (leftPanel && uploadForm && contentsSection && documentEntries) {
                // Left panel should have scrolling capability
                leftPanel.style.overflowY = 'auto';
                leftPanel.style.maxHeight = 'calc(80vh - 40px)';
                
                // Form should NOT have scrolling
                uploadForm.style.overflowY = 'visible';
                uploadForm.style.width = '100%';
                
                // Make sure both form fields have consistent height
                if (singleFormFields && compiledFormFields) {
                    singleFormFields.style.maxHeight = 'calc(80vh - 120px)';
                    compiledFormFields.style.maxHeight = 'calc(80vh - 120px)';
                }
                
                // Contents section should not scroll
                contentsSection.style.maxHeight = 'none';
                contentsSection.style.overflowY = 'visible';
                contentsSection.style.border = '1px solid #f0f0f0';
                contentsSection.style.borderRadius = '8px';
                contentsSection.style.padding = '15px';
                
                // Fix document entries container
                documentEntries.style.width = '100%';
                documentEntries.style.boxSizing = 'border-box';
                
                // Fix preview buttons
                document.querySelectorAll('.preview-btn-container').forEach(container => {
                    container.style.position = 'absolute';
                    container.style.top = '25px';
                    container.style.right = '20px';
                    container.style.zIndex = '99';
                });
                
                document.querySelectorAll('.preview-btn').forEach(btn => {
                    btn.style.borderRadius = '50%';
                    btn.style.padding = '0';
                    btn.style.width = '46px';
                    btn.style.height = '46px';
                    btn.style.display = 'flex';
                    btn.style.alignItems = 'center';
                    btn.style.justifyContent = 'center';
                });
                
                // Center file upload areas and their content
                document.querySelectorAll('.file-upload-area').forEach(area => {
                    area.style.display = 'flex';
                    area.style.flexDirection = 'column';
                    area.style.alignItems = 'center';
                    area.style.justifyContent = 'center';
                    area.style.textAlign = 'center';
                });
                
                // Center selected file names 
                document.querySelectorAll('.selected-file').forEach(fileNameDiv => {
                    fileNameDiv.style.textAlign = 'center';
                    fileNameDiv.style.width = '100%';
                });
            }
            
            // Function to preview PDF file
            function previewPDF(file) {
                const fileReader = new FileReader();
                
                fileReader.onload = function() {
                    const typedarray = new Uint8Array(this.result);
                    
                    // Load PDF using PDF.js
                    pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                        // Update page count
                        document.getElementById('page-count').textContent = pdf.numPages;
                        
                        // Get the first page to extract abstract
                        return pdf.getPage(1);
                    }).then(page => {
                        // Get text content of first page
                        return page.getTextContent();
                    }).then(textContent => {
                        // Extract text from the first page (simplified "abstract")
                        const text = textContent.items.map(item => item.str).join(' ');
                        const abstractText = text.substring(0, 300) + '...';
                        document.getElementById('preview-abstract').textContent = abstractText;
                        
                        // Enable read document button
                        const readBtn = document.getElementById('read-document');
                        readBtn.classList.remove('disabled-button');
                        readBtn.removeAttribute('disabled');
                    }).catch(error => {
                        console.error('Error loading PDF:', error);
                        document.getElementById('preview-abstract').textContent = 'Failed to load PDF preview.';
                    });
                };
                
                fileReader.readAsArrayBuffer(file);
            }
        });
    </script>
</body>
</html>